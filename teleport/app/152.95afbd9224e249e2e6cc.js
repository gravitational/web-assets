"use strict";(self.webpackChunk_gravitational_teleport=self.webpackChunk_gravitational_teleport||[]).push([[152],{3937:(e,t,r)=>{r.d(t,{j2:()=>R,Oq:()=>d,sN:()=>n.sN,ZH:()=>n.ZH});var n=r(2760),o=r(2784),s=r(7849),i=r(3757);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class d extends o.Component{constructor(e){super(e),c(this,"anchorEl",null),c(this,"state",{open:!1}),c(this,"onOpen",(e=>{e.stopPropagation(),this.setState({open:!0})})),c(this,"onClose",(()=>{this.setState({open:!1})})),this.state.open=e.defaultOpen||!1}render(){const{open:e}=this.state,{children:t,buttonIconProps:r,menuProps:c}=this.props;return o.createElement(o.Fragment,null,o.createElement(s.Ei,a({},r,{setRef:e=>this.anchorEl=e,onClick:this.onOpen,"data-testid":"button"}),o.createElement(i.mH4,null)),o.createElement(n.ZP,a({menuListCss:h,anchorEl:this.anchorEl,open:e,onClose:this.onClose,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},c),e&&this.renderItems(t)))}renderItems(e){return o.Children.toArray(e).map((e=>o.cloneElement(e,{onClick:this.makeOnClick(e.props.onClick)})))}makeOnClick(e){return t=>{t.stopPropagation(),this.onClose(),e&&e(t)}}}const h=()=>"\n  min-width: 100px;\n";function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class R extends o.Component{constructor(e){super(e),E(this,"anchorEl",null),E(this,"state",{open:!1}),E(this,"onOpen",(e=>{e.stopPropagation(),this.setState({open:!0})})),E(this,"onClose",(()=>{this.setState({open:!1})})),this.state.open=e.defaultOpen||!1}render(){const{open:e}=this.state,{children:t,menuProps:r,buttonProps:a}=this.props;return o.createElement(o.Fragment,null,o.createElement(s.ku,l({height:"24px",size:"small",setRef:e=>this.anchorEl=e,onClick:this.onOpen},a),"OPTIONS",o.createElement(i.E_,{ml:2,mr:-2,fontSize:"2",color:"text.secondary"})),o.createElement(n.ZP,l({getContentAnchorEl:null,menuListCss:u,anchorEl:this.anchorEl,open:e,onClose:this.onClose,transformOrigin:{vertical:"top",horizontal:"right"},anchorOrigin:{vertical:"center",horizontal:"right"}},r),e&&this.renderItems(t)))}renderItems(e){return o.Children.toArray(e).map((e=>o.cloneElement(e,{onClick:this.makeOnClick(e.props.onClick)})))}makeOnClick(e){return t=>{t.stopPropagation(),this.onClose(),e&&e(t)}}}const u=()=>"\n  min-width: 100px;\n"},4696:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(2784);const o=r(2418).Z.create("shared/hooks/useAttempt");function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[t,r]=n.useState((()=>({status:e,statusText:""})));function s(e){o.error("attempt",e),r({status:"failed",statusText:e.message})}const i=(0,n.useCallback)((e=>{try{return r({status:"processing"}),e().then((()=>(r({status:"success"}),!0))).catch((e=>(s(e),!1)))}catch(e){return s(e),Promise.resolve(!1)}}),[]);return{attempt:t,setAttempt:r,run:i,handleError:s}}},7559:(e,t,r)=>{r.d(t,{O:()=>n});const n={dark:"#000",light:"#fff",subtle:"#CFD8DC",inverse:"#B0BEC5",link:"#039BE5",error:"#FF1744",terminal:"#28FE14",terminalDark:"#01172C",bgTerminal:"#010B1C",primary:{light:"#03203C",lighter:"#092F52",dark:"#01172C",main:"#010B1C"},text:"#263238",success:"#00BFA5",progressBarColor:"#00BFA5"}},2282:(e,t,r)=>{r.d(t,{Z:()=>c});var n=r(2784),o=r(1727);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c=function(e){const{tdpCli:t,tdpCliInit:r=!1,tdpCliOnPngFrame:s,tdpCliOnClipboardData:a,tdpCliOnTdpError:c,tdpCliOnTdpWarning:d,tdpCliOnWsClose:h,tdpCliOnWsOpen:l,tdpCliOnClientScreenSpec:E,onKeyDown:R,onKeyUp:u,onMouseMove:p,onMouseDown:S,onMouseUp:D,onMouseWheelScroll:y,onContextMenu:f,style:_}=e,g=(0,n.useRef)(null);return g.current&&(g.current.tabIndex=-1,g.current.style.outline="none",g.current.focus()),(0,n.useEffect)((()=>{if(t&&s){const r=g.current.getContext("2d");var e=[];const n=()=>{if(e.length){for(let t=0;t<e.length;t++)s(r,e[t]);e=[]}requestAnimationFrame(n)};requestAnimationFrame(n);const i=t=>{e.push(t)};return t.on(o.RB.TDP_PNG_FRAME,i),()=>{t.removeListener(o.RB.TDP_PNG_FRAME,i)}}}),[t,s]),(0,n.useEffect)((()=>{if(t&&E){const e=g.current,r=t=>{E(e,t)};return t.on(o.RB.TDP_CLIENT_SCREEN_SPEC,r),()=>{t.removeListener(o.RB.TDP_CLIENT_SCREEN_SPEC,r)}}}),[t,E]),(0,n.useEffect)((()=>{if(t&&a)return t.on(o.RB.TDP_CLIPBOARD_DATA,a),()=>{t.removeListener(o.RB.TDP_CLIPBOARD_DATA,a)}}),[t,a]),(0,n.useEffect)((()=>{if(t&&c)return t.on(o.RB.TDP_ERROR,c),t.on(o.RB.CLIENT_ERROR,c),()=>{t.removeListener(o.RB.TDP_ERROR,c),t.removeListener(o.RB.CLIENT_ERROR,c)}}),[t,c]),(0,n.useEffect)((()=>{if(t&&d)return t.on(o.RB.TDP_WARNING,d),t.on(o.RB.CLIENT_WARNING,d),()=>{t.removeListener(o.RB.TDP_WARNING,d),t.removeListener(o.RB.CLIENT_WARNING,d)}}),[t,d]),(0,n.useEffect)((()=>{if(t&&h)return t.on(o.RB.WS_CLOSE,h),()=>{t.removeListener(o.RB.WS_CLOSE,h)}}),[t,h]),(0,n.useEffect)((()=>{if(t&&l)return t.on(o.RB.WS_OPEN,l),()=>{t.removeListener(o.RB.WS_OPEN,l)}}),[t,l]),(0,n.useEffect)((()=>{const e=g.current,t=f;return f&&(e.oncontextmenu=t),()=>{f&&e.removeEventListener("contextmenu",t)}}),[f]),(0,n.useEffect)((()=>{const e=g.current,r=r=>{p(t,e,r)};return p&&(e.onmousemove=r),()=>{p&&e.removeEventListener("mousemove",r)}}),[t,p]),(0,n.useEffect)((()=>{const e=g.current,r=e=>{S(t,e)};return S&&(e.onmousedown=r),()=>{S&&e.removeEventListener("mousedown",r)}}),[t,S]),(0,n.useEffect)((()=>{const e=g.current,r=e=>{D(t,e)};return D&&(e.onmouseup=r),()=>{D&&e.removeEventListener("mouseup",r)}}),[t,D]),(0,n.useEffect)((()=>{const e=g.current,r=e=>{y(t,e)};return y&&(e.onwheel=r),()=>{y&&e.removeEventListener("wheel",r)}}),[t,y]),(0,n.useEffect)((()=>{const e=g.current,r=e=>{R(t,e)};return R&&(e.onkeydown=r),()=>{R&&e.removeEventListener("keydown",r)}}),[t,R]),(0,n.useEffect)((()=>{const e=g.current,r=e=>{u(t,e)};return u&&(e.onkeyup=r),()=>{u&&e.removeEventListener("keyup",r)}}),[t,u]),(0,n.useEffect)((()=>{if(t&&r)return t.init(),()=>{t.nuke()}}),[t,r]),n.createElement("canvas",{style:i({},_),ref:g})}},8082:(e,t,r)=>{r.d(t,{j:()=>o});var n=r(2699);class o extends n.EventEmitter{constructor(){super()}sendWebAuthn(e){throw new Error("Not implemented")}}},1727:(e,t,r)=>{r.d(t,{BN:()=>l,pz:()=>I,OZ:()=>T,Yc:()=>E,pe:()=>A,RB:()=>C});var n=r(2418),o=r(9175),s=r(8082),i=r(3042);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{TextEncoder:c,TextDecoder:d}=r(3335);var h,l,E,R,u,p;function S(e){if(e===R.Info)return R.Info;if(e===R.Warning)return R.Warning;if(e===R.Error)return R.Error;throw new Error(`received invalid severity level: ${e}`)}window.TextEncoder=window.TextEncoder||c,window.TextDecoder=window.TextDecoder||d,function(e){e[e.CLIENT_SCREEN_SPEC=1]="CLIENT_SCREEN_SPEC",e[e.PNG_FRAME=2]="PNG_FRAME",e[e.MOUSE_MOVE=3]="MOUSE_MOVE",e[e.MOUSE_BUTTON=4]="MOUSE_BUTTON",e[e.KEYBOARD_BUTTON=5]="KEYBOARD_BUTTON",e[e.CLIPBOARD_DATA=6]="CLIPBOARD_DATA",e[e.CLIENT_USERNAME=7]="CLIENT_USERNAME",e[e.MOUSE_WHEEL_SCROLL=8]="MOUSE_WHEEL_SCROLL",e[e.ERROR=9]="ERROR",e[e.MFA_JSON=10]="MFA_JSON",e[e.SHARED_DIRECTORY_ANNOUNCE=11]="SHARED_DIRECTORY_ANNOUNCE",e[e.SHARED_DIRECTORY_ACKNOWLEDGE=12]="SHARED_DIRECTORY_ACKNOWLEDGE",e[e.SHARED_DIRECTORY_INFO_REQUEST=13]="SHARED_DIRECTORY_INFO_REQUEST",e[e.SHARED_DIRECTORY_INFO_RESPONSE=14]="SHARED_DIRECTORY_INFO_RESPONSE",e[e.SHARED_DIRECTORY_CREATE_REQUEST=15]="SHARED_DIRECTORY_CREATE_REQUEST",e[e.SHARED_DIRECTORY_CREATE_RESPONSE=16]="SHARED_DIRECTORY_CREATE_RESPONSE",e[e.SHARED_DIRECTORY_DELETE_REQUEST=17]="SHARED_DIRECTORY_DELETE_REQUEST",e[e.SHARED_DIRECTORY_DELETE_RESPONSE=18]="SHARED_DIRECTORY_DELETE_RESPONSE",e[e.SHARED_DIRECTORY_READ_REQUEST=19]="SHARED_DIRECTORY_READ_REQUEST",e[e.SHARED_DIRECTORY_READ_RESPONSE=20]="SHARED_DIRECTORY_READ_RESPONSE",e[e.SHARED_DIRECTORY_WRITE_REQUEST=21]="SHARED_DIRECTORY_WRITE_REQUEST",e[e.SHARED_DIRECTORY_WRITE_RESPONSE=22]="SHARED_DIRECTORY_WRITE_RESPONSE",e[e.SHARED_DIRECTORY_MOVE_REQUEST=23]="SHARED_DIRECTORY_MOVE_REQUEST",e[e.SHARED_DIRECTORY_MOVE_RESPONSE=24]="SHARED_DIRECTORY_MOVE_RESPONSE",e[e.SHARED_DIRECTORY_LIST_REQUEST=25]="SHARED_DIRECTORY_LIST_REQUEST",e[e.SHARED_DIRECTORY_LIST_RESPONSE=26]="SHARED_DIRECTORY_LIST_RESPONSE",e[e.PNG2_FRAME=27]="PNG2_FRAME",e[e.NOTIFICATION=28]="NOTIFICATION",e[e.__LAST=29]="__LAST"}(h||(h={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(l||(l={})),function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(E||(E={})),function(e){e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(R||(R={})),function(e){e[e.Nil=0]="Nil",e[e.Failed=1]="Failed",e[e.DoesNotExist=2]="DoesNotExist",e[e.AlreadyExists=3]="AlreadyExists"}(u||(u={})),function(e){e[e.File=0]="File",e[e.Directory=1]="Directory"}(p||(p={}));class D{constructor(){a(this,"encoder",new window.TextEncoder),a(this,"decoder",new window.TextDecoder),a(this,"_keyScancodes",{Escape:1,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Digit0:11,Minus:12,Equal:13,Backspace:14,Tab:15,KeyQ:16,KeyW:17,KeyE:18,KeyR:19,KeyT:20,KeyY:21,KeyU:22,KeyI:23,KeyO:24,KeyP:25,BracketLeft:26,BracketRight:27,Enter:28,ControlLeft:29,KeyA:30,KeyS:31,KeyD:32,KeyF:33,KeyG:34,KeyH:35,KeyJ:36,KeyK:37,KeyL:38,Semicolon:39,Quote:40,Backquote:41,ShiftLeft:42,Backslash:43,KeyZ:44,KeyX:45,KeyC:46,KeyV:47,KeyB:48,KeyN:49,KeyM:50,Comma:51,Period:52,Slash:53,ShiftRight:54,NumpadMultiply:55,AltLeft:56,Space:57,CapsLock:58,F1:59,F2:60,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,F10:68,Pause:69,ScrollLock:70,Numpad7:71,Numpad8:72,Numpad9:73,NumpadSubtract:74,Numpad4:75,Numpad5:76,Numpad6:77,NumpadAdd:78,Numpad1:79,Numpad2:80,Numpad3:81,Numpad0:82,NumpadDecimal:83,IntlBackslash:86,F11:87,F12:88,NumpadEqual:89,F13:100,F14:101,F15:102,F16:103,F17:104,F18:105,F19:106,F20:107,F21:108,F22:109,F23:110,KanaMode:112,IntlRo:115,F24:118,Lang4:119,Lang3:119,Convert:121,NonConvert:123,IntlYen:125,NumpadComma:126,Undo:57352,Paste:57354,MediaTrackPrevious:57360,Cut:57367,Copy:57368,MediaTrackNext:57369,NumpadEnter:57372,ControlRight:57373,AudioVolumeMute:57376,LaunchApp2:57377,MediaPlayPause:57378,MediaStop:57380,AudioVolumeDown:57390,VolumeDown:57390,AudioVolumeUp:57392,VolumeUp:57392,BrowserHome:57394,NumpadDivide:57397,PrintScreen:57399,AltRight:57400,NumLock:57413,Home:57415,ArrowUp:57416,PageUp:57417,ArrowLeft:57419,ArrowRight:57421,End:57423,ArrowDown:57424,PageDown:57425,Insert:57426,Delete:57427,MetaLeft:57435,OSLeft:57435,MetaRight:57436,OSRight:57436,ContextMenu:57437,Power:57438,BrowserSearch:57445,BrowserFavorites:57446,BrowserRefresh:57447,BrowserStop:57448,BrowserForward:57449,BrowserBack:57450,LaunchApp1:57451,LaunchMail:57452,MediaSelect:57453})}encodeClientScreenSpec(e){const{width:t,height:r}=e,n=new ArrayBuffer(9),o=new DataView(n);return o.setUint8(0,h.CLIENT_SCREEN_SPEC),o.setUint32(1,t),o.setUint32(5,r),n}decodeClientScreenSpec(e){let t=new DataView(e);return{width:t.getUint32(1),height:t.getUint32(5)}}encodeMouseMove(e,t){const r=new ArrayBuffer(9),n=new DataView(r);return n.setUint8(0,h.MOUSE_MOVE),n.setUint32(1,e),n.setUint32(5,t),r}encodeMouseButton(e,t){const r=new ArrayBuffer(3),n=new DataView(r);return n.setUint8(0,h.MOUSE_BUTTON),n.setUint8(1,e),n.setUint8(2,t),r}encodeKeyboardInput(e,t){const r=this._keyScancodes[e];if(!r)return null;const n=new ArrayBuffer(6),o=new DataView(n);return o.setUint8(0,h.KEYBOARD_BUTTON),o.setUint32(1,r),o.setUint8(5,t),n}_encodeStringMessage(e,t){const r=this.encoder.encode(t),n=y+f+r.length,o=new ArrayBuffer(n),s=new DataView(o);let i=0;return s.setUint8(i++,e),s.setUint32(i,r.length),i+=f,r.forEach((e=>{s.setUint8(i++,e)})),o}encodeClipboardData(e){return this._encodeStringMessage(h.CLIPBOARD_DATA,e.data)}encodeUsername(e){return this._encodeStringMessage(h.CLIENT_USERNAME,e)}encodeMouseWheelScroll(e,t){const r=new ArrayBuffer(4),n=new DataView(r);return n.setUint8(0,h.MOUSE_WHEEL_SCROLL),n.setUint8(1,e),n.setUint16(2,t),r}encodeMfaJson(e){const t=this.encoder.encode(e.jsonString),r=y+y+f+t.length,n=new ArrayBuffer(r),o=new DataView(n);let s=0;return o.setUint8(s++,h.MFA_JSON),o.setUint8(s++,e.mfaType.charCodeAt(0)),o.setUint32(s,t.length),s+=f,t.forEach((e=>{o.setUint8(s++,e)})),n}encodeSharedDirectoryAnnounce(e){const t=this.encoder.encode(e.name),r=y+3*f+t.length,n=new ArrayBuffer(r),o=new DataView(n);let s=0;return o.setUint8(s++,h.SHARED_DIRECTORY_ANNOUNCE),o.setUint32(s,e.completionId),s+=f,o.setUint32(s,e.directoryId),s+=f,o.setUint32(s,t.length),s+=f,t.forEach((e=>{o.setUint8(s++,e)})),n}encodeSharedDirectoryInfoResponse(e){const t=new ArrayBuffer(y+2*f),r=new DataView(t);let n=0;r.setUint8(n++,h.SHARED_DIRECTORY_INFO_RESPONSE),r.setUint32(n,e.completionId),n+=f,r.setUint32(n,e.errCode),n+=f;const o=this.encodeFileSystemObject(e.fso);return new Uint8Array([...new Uint8Array(t),...new Uint8Array(o)]).buffer}encodeSharedDirectoryCreateResponse(e){const t=new ArrayBuffer(y+2*f),r=new DataView(t);let n=0;r.setUint8(n,h.SHARED_DIRECTORY_CREATE_RESPONSE),n+=y,r.setUint32(n,e.completionId),n+=f,r.setUint32(n,e.errCode),n+=f;const o=this.encodeFileSystemObject(e.fso);return new Uint8Array([...new Uint8Array(t),...new Uint8Array(o)]).buffer}encodeSharedDirectoryDeleteResponse(e){const t=new ArrayBuffer(y+2*f),r=new DataView(t);let n=0;return r.setUint8(n,h.SHARED_DIRECTORY_DELETE_RESPONSE),n+=y,r.setUint32(n,e.completionId),n+=f,r.setUint32(n,e.errCode),n+=f,t}encodeSharedDirectoryReadResponse(e){const t=y+3*f+y*e.readDataLength,r=new ArrayBuffer(t),n=new DataView(r);let o=0;return n.setUint8(o,h.SHARED_DIRECTORY_READ_RESPONSE),o+=y,n.setUint32(o,e.completionId),o+=f,n.setUint32(o,e.errCode),o+=f,n.setUint32(o,e.readDataLength),o+=f,e.readData.forEach((e=>{n.setUint8(o++,e)})),r}encodeSharedDirectoryWriteResponse(e){const t=new ArrayBuffer(y+3*f),r=new DataView(t);let n=0;return r.setUint8(n,h.SHARED_DIRECTORY_WRITE_RESPONSE),n+=y,r.setUint32(n,e.completionId),n+=f,r.setUint32(n,e.errCode),n+=f,r.setUint32(n,e.bytesWritten),n+=f,t}encodeSharedDirectoryMoveResponse(e){const t=new ArrayBuffer(y+2*f),r=new DataView(t);let n=0;return r.setUint8(n,h.SHARED_DIRECTORY_MOVE_RESPONSE),n+=y,r.setUint32(n,e.completionId),n+=f,r.setUint32(n,e.errCode),n+=f,t}encodeSharedDirectoryListResponse(e){const t=new ArrayBuffer(y+3*f),r=new DataView(t);let n=0;r.setUint8(n++,h.SHARED_DIRECTORY_LIST_RESPONSE),r.setUint32(n,e.completionId),n+=f,r.setUint32(n,e.errCode),n+=f,r.setUint32(n,e.fsoList.length),n+=f;let o=new Uint8Array(t);return e.fsoList.forEach((e=>{const t=this.encodeFileSystemObject(e);o=new Uint8Array([...o,...new Uint8Array(t)])})),o.buffer}encodeFileSystemObject(e){const t=this.encoder.encode(e.path),r=y+2*_+2*f+t.length,n=new ArrayBuffer(r),o=new DataView(n);let s=0;return o.setBigUint64(s,e.lastModified),s+=_,o.setBigUint64(s,e.size),s+=_,o.setUint32(s,e.fileType),s+=f,o.setUint8(s,e.isEmpty?1:0),s+=y,o.setUint32(s,t.length),s+=f,t.forEach((e=>{o.setUint8(s++,e)})),n}decodeClipboardData(e){return{data:this.decodeStringMessage(e)}}decodeMessageType(e){const t=new DataView(e).getUint8(0);if(!(t in h)||t===h.__LAST)throw new Error(`invalid message type: ${t}`);return t}decodeErrorMessage(e){return this.decodeStringMessage(e)}decodeNotification(e){const t=new DataView(e);let r=0;r+=y;const n=t.getUint32(r);return r+=f,r+=n,{message:this.decodeStringMessage(e),severity:S(t.getUint8(r))}}decodeMfaJson(e){const t=new DataView(e);let r=0;r+=y;const n=String.fromCharCode(t.getUint8(r));if(r+=y,"n"!==n&&"u"!==n)throw new Error(`invalid mfa type ${n}, should be "n" or "u"`);return r+=f,{mfaType:n,jsonString:this.decoder.decode(new Uint8Array(e.slice(r)))}}decodeStringMessage(e){const t=y+f;return this.decoder.decode(new Uint8Array(e.slice(t)))}decodePngFrame(e,t){const r=new DataView(e),n=new Image;let o=0;o+=y;const s=r.getUint32(o);o+=f;const i=r.getUint32(o);o+=f;const a=r.getUint32(o);o+=f;const c=r.getUint32(o);o+=f;const d={left:s,top:i,right:a,bottom:c,data:n};return d.data.onload=t(d),d.data.src=this.asBase64Url(e,o),d}decodePng2Frame(e,t){const r=new DataView(e),n=new Image;let o=0;o+=y,o+=f;const s=r.getUint32(o);o+=f;const i=r.getUint32(o);o+=f;const a=r.getUint32(o);o+=f;const c=r.getUint32(o);o+=f;const d={left:s,top:i,right:a,bottom:c,data:n};return d.data.onload=t(d),d.data.src=this.asBase64Url(e,o),d}decodeSharedDirectoryAcknowledge(e){const t=new DataView(e);let r=0;r+=y;const n=function(e){if(!(e in u))throw new Error(`attempted to convert invalid error code ${e}`);return e}(t.getUint32(r));return r+=f,{errCode:n,directoryId:t.getUint32(5)}}decodeSharedDirectoryInfoRequest(e){const t=new DataView(e);let r=0;r+=y;const n=t.getUint32(r);r+=f;const o=t.getUint32(r);return r+=f,r+=f,{completionId:n,directoryId:o,path:this.decoder.decode(new Uint8Array(e.slice(r)))}}decodeSharedDirectoryCreateRequest(e){const t=new DataView(e);let r=0;r+=y;const n=t.getUint32(r);r+=f;const o=t.getUint32(r);r+=f;const s=t.getUint32(r);return r+=f,r+=f,{completionId:n,directoryId:o,fileType:s,path:this.decoder.decode(new Uint8Array(e.slice(r)))}}decodeSharedDirectoryDeleteRequest(e){const t=new DataView(e);let r=0;r+=y;const n=t.getUint32(r);r+=f;const o=t.getUint32(r);return r+=f,r+=f,{completionId:n,directoryId:o,path:this.decoder.decode(new Uint8Array(e.slice(r)))}}decodeSharedDirectoryReadRequest(e){const t=new DataView(e);let r=0;r+=y;const n=t.getUint32(r);r+=f;const o=t.getUint32(r);r+=f;const s=t.getUint32(r);r+=f;const i=this.decoder.decode(new Uint8Array(e.slice(r,r+s)));r+=s;const a=t.getBigUint64(r);return r+=_,{completionId:n,directoryId:o,pathLength:s,path:i,offset:a,length:t.getUint32(r)}}decodeSharedDirectoryWriteRequest(e){const t=new DataView(e);let r=y;const n=t.getUint32(r);r+=f;const o=t.getUint32(r);r+=f;const s=t.getBigUint64(r);r+=_;const i=t.getUint32(r);r+=f;const a=this.decoder.decode(new Uint8Array(e.slice(r,r+i)));r+=i;const c=t.getUint32(r);return r+=f,{completionId:n,directoryId:o,pathLength:i,path:a,offset:s,writeData:new Uint8Array(e.slice(r,r+c))}}decodeSharedDirectoryMoveRequest(e){const t=new DataView(e);let r=y;const n=t.getUint32(r);r+=f;const o=t.getUint32(r);r+=f;const s=t.getUint32(r);r+=f;const i=this.decoder.decode(new Uint8Array(e.slice(r,r+s)));r+=s;const a=t.getUint32(r);return r+=f,{completionId:n,directoryId:o,originalPathLength:s,originalPath:i,newPathLength:a,newPath:this.decoder.decode(new Uint8Array(e.slice(r,r+a)))}}decodeSharedDirectoryListRequest(e){return this.decodeSharedDirectoryInfoRequest(e)}asBase64Url(e,t){return`data:image/png;base64,${(0,i.sM)(e.slice(t))}`}}const y=1,f=4,_=2*f;class g{constructor(){var e;e=void 0,"dir"in this?Object.defineProperty(this,"dir",{value:e,enumerable:!0,configurable:!0,writable:!0}):this.dir=e}add(e){if(this.dir)throw new Error("SharedDirectoryManager currently only supports sharing a single directory");this.dir=e}getName(){return this.checkReady(),this.dir.name}async getInfo(e){this.checkReady();const t=await this.walkPath(e);let r=!0;if("directory"===t.kind){let n=t;for await(const e of n.keys()){r=!1;break}return{size:4096,lastModified:0,kind:t.kind,isEmpty:r,path:e}}let n=await t.getFile();return{size:n.size,lastModified:n.lastModified,kind:t.kind,isEmpty:r,path:e}}async listContents(e){this.checkReady();const t=await this.walkPath(e);if("directory"!==t.kind)throw new Error("cannot list the contents of a file");let r=[];for await(const n of t.values()){let t=e;t=""!==t?[t,n.name].join("/"):n.name,r.push(await this.getInfo(t))}return r}async readFile(e,t,r){this.checkReady();const n=await this.walkPath(e);if("file"!==n.kind)throw new Error("cannot read the bytes of a directory");const o=await n.getFile();return new Uint8Array(await o.slice(Number(t),Number(t)+r).arrayBuffer())}async writeFile(e,t,r){this.checkReady();const n=await this.walkPath(e);if("file"!==n.kind)throw new Error("cannot read the bytes of a directory");const o=await n.createWritable({keepExistingData:!0});return o.write({type:"write",position:Number(t),data:r}),o.close(),r.length}async create(e,t){let r=e.split("/");const n=r.pop(),o=r.join("/"),s=await this.walkPath(o);if("directory"!==s.kind)throw new w("destination was a file, not a directory");t===p.File?await s.getFileHandle(n,{create:!0}):await s.getDirectoryHandle(n,{create:!0})}async delete(e){let t=e.split("/");const r=t.pop(),n=t.join("/"),o=await this.walkPath(n);if("directory"!==o.kind)throw new w("destination was a file, not a directory");await o.removeEntry(r,{recursive:!0})}async walkPath(e){if(""===e)return this.dir;let t=e.split("/"),r=async(e,t)=>{let n=t.shift();for await(const o of e.values())if(o.name===n){if(0===t.length)return o;if("directory"===o.kind)return r(o,t);break}throw new w("path does not exist")};return r(this.dir,t)}checkReady(){if(!this.dir)throw new Error("attempted to use a shared directory before one was initialized")}}class w extends Error{constructor(e){super(e)}}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var C,m,T;!function(e){e.TDP_CLIENT_SCREEN_SPEC="tdp client screen spec",e.TDP_PNG_FRAME="tdp png frame",e.TDP_CLIPBOARD_DATA="tdp clipboard data",e.TDP_ERROR="tdp error",e.CLIENT_ERROR="client error",e.TDP_WARNING="tdp warning",e.CLIENT_WARNING="client warning",e.WS_OPEN="ws open",e.WS_CLOSE="ws close"}(C||(C={}));class A extends s.j{constructor(e){super(),O(this,"codec",void 0),O(this,"socket",void 0),O(this,"socketAddr",void 0),O(this,"sdManager",void 0),O(this,"logger",n.Z.create("TDPClient")),this.socketAddr=e,this.codec=new D,this.sdManager=new g}init(){this.socket=new WebSocket(this.socketAddr),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{this.logger.info("websocket is open"),this.emit(C.WS_OPEN)},this.socket.onmessage=async e=>{await this.processMessage(e.data)},this.socket.onerror=null,this.socket.onclose=()=>{this.logger.info("websocket is closed"),this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket=null,this.emit(C.WS_CLOSE)}}async processMessage(e){try{const t=this.codec.decodeMessageType(e);switch(t){case h.PNG_FRAME:this.handlePngFrame(e);break;case h.PNG2_FRAME:this.handlePng2Frame(e);break;case h.CLIENT_SCREEN_SPEC:this.handleClientScreenSpec(e);break;case h.MOUSE_BUTTON:this.handleMouseButton(e);break;case h.MOUSE_MOVE:this.handleMouseMove(e);break;case h.CLIPBOARD_DATA:this.handleClipboardData(e);break;case h.ERROR:this.handleError(new Error(this.codec.decodeErrorMessage(e)),C.TDP_ERROR);break;case h.NOTIFICATION:this.handleTdpNotification(e);break;case h.MFA_JSON:this.handleMfaChallenge(e);break;case h.SHARED_DIRECTORY_ACKNOWLEDGE:this.handleSharedDirectoryAcknowledge(e);break;case h.SHARED_DIRECTORY_INFO_REQUEST:this.handleSharedDirectoryInfoRequest(e);break;case h.SHARED_DIRECTORY_CREATE_REQUEST:await this.handleSharedDirectoryCreateRequest(e);break;case h.SHARED_DIRECTORY_DELETE_REQUEST:this.handleSharedDirectoryDeleteRequest(e);break;case h.SHARED_DIRECTORY_READ_REQUEST:this.handleSharedDirectoryReadRequest(e);break;case h.SHARED_DIRECTORY_WRITE_REQUEST:this.handleSharedDirectoryWriteRequest(e);break;case h.SHARED_DIRECTORY_MOVE_REQUEST:this.handleSharedDirectoryMoveRequest(e);break;case h.SHARED_DIRECTORY_LIST_REQUEST:this.handleSharedDirectoryListRequest(e);break;default:this.logger.warn(`received unsupported message type ${t}`)}}catch(e){this.handleError(e,C.CLIENT_ERROR)}}handleClientScreenSpec(e){this.logger.warn(`received unsupported message type ${this.codec.decodeMessageType(e)}`)}handleMouseButton(e){this.logger.warn(`received unsupported message type ${this.codec.decodeMessageType(e)}`)}handleMouseMove(e){this.logger.warn(`received unsupported message type ${this.codec.decodeMessageType(e)}`)}handleClipboardData(e){this.emit(C.TDP_CLIPBOARD_DATA,this.codec.decodeClipboardData(e))}handleTdpNotification(e){const t=this.codec.decodeNotification(e);t.severity===R.Error?this.handleError(new Error(t.message),C.TDP_ERROR):t.severity===R.Warning&&this.handleWarning(t.message,C.TDP_WARNING)}handlePngFrame(e){this.codec.decodePngFrame(e,(e=>this.emit(C.TDP_PNG_FRAME,e)))}handlePng2Frame(e){this.codec.decodePng2Frame(e,(e=>this.emit(C.TDP_PNG_FRAME,e)))}handleMfaChallenge(e){try{const t=this.codec.decodeMfaJson(e);"n"==t.mfaType?this.emit(o.y2.WEBAUTHN_CHALLENGE,t.jsonString):this.handleError(new Error("Multifactor authentication is required for accessing this desktop,       however the U2F API for hardware keys is not supported for desktop sessions.       Please notify your system administrator to update cluster settings       to use WebAuthn as the second factor protocol."),C.CLIENT_ERROR)}catch(e){this.handleError(e,C.CLIENT_ERROR)}}wasSuccessful(e){return e===u.Nil||(this.handleError(new Error(`Encountered shared directory error: ${e}`),C.CLIENT_ERROR),!1)}handleSharedDirectoryAcknowledge(e){const t=this.codec.decodeSharedDirectoryAcknowledge(e);if(this.wasSuccessful(t.errCode))try{this.logger.info("Started sharing directory: "+this.sdManager.getName())}catch(e){this.handleError(e,C.CLIENT_ERROR)}}async handleSharedDirectoryInfoRequest(e){const t=this.codec.decodeSharedDirectoryInfoRequest(e),r=t.path;try{const e=await this.sdManager.getInfo(r);this.sendSharedDirectoryInfoResponse({completionId:t.completionId,errCode:u.Nil,fso:this.toFso(e)})}catch(e){e.constructor===w?this.sendSharedDirectoryInfoResponse({completionId:t.completionId,errCode:u.DoesNotExist,fso:{lastModified:BigInt(0),fileType:p.File,size:BigInt(0),isEmpty:!0,path:r}}):this.handleError(e,C.CLIENT_ERROR)}}async handleSharedDirectoryCreateRequest(e){const t=this.codec.decodeSharedDirectoryCreateRequest(e);try{await this.sdManager.create(t.path,t.fileType);const e=await this.sdManager.getInfo(t.path);this.sendSharedDirectoryCreateResponse({completionId:t.completionId,errCode:u.Nil,fso:this.toFso(e)})}catch(e){this.sendSharedDirectoryCreateResponse({completionId:t.completionId,errCode:u.Failed,fso:{lastModified:BigInt(0),fileType:p.File,size:BigInt(0),isEmpty:!0,path:t.path}}),this.handleWarning(e.message,C.CLIENT_WARNING)}}async handleSharedDirectoryDeleteRequest(e){const t=this.codec.decodeSharedDirectoryDeleteRequest(e);try{await this.sdManager.delete(t.path),this.sendSharedDirectoryDeleteResponse({completionId:t.completionId,errCode:u.Nil})}catch(e){this.sendSharedDirectoryDeleteResponse({completionId:t.completionId,errCode:u.Failed}),this.handleWarning(e.message,C.CLIENT_WARNING)}}async handleSharedDirectoryReadRequest(e){const t=this.codec.decodeSharedDirectoryReadRequest(e);try{const e=await this.sdManager.readFile(t.path,t.offset,t.length);this.sendSharedDirectoryReadResponse({completionId:t.completionId,errCode:u.Nil,readDataLength:e.length,readData:e})}catch(e){this.handleError(e,C.CLIENT_ERROR)}}async handleSharedDirectoryWriteRequest(e){const t=this.codec.decodeSharedDirectoryWriteRequest(e);try{const e=await this.sdManager.writeFile(t.path,t.offset,t.writeData);this.sendSharedDirectoryWriteResponse({completionId:t.completionId,errCode:u.Nil,bytesWritten:e})}catch(e){this.handleError(e,C.CLIENT_ERROR)}}handleSharedDirectoryMoveRequest(e){const t=this.codec.decodeSharedDirectoryMoveRequest(e);this.sendSharedDirectoryMoveResponse({completionId:t.completionId,errCode:u.Failed}),this.handleWarning("Moving files and directories within a shared         directory is not supported.",C.CLIENT_WARNING)}async handleSharedDirectoryListRequest(e){try{const t=this.codec.decodeSharedDirectoryListRequest(e),r=t.path,n=(await this.sdManager.listContents(r)).map((e=>this.toFso(e)));this.sendSharedDirectoryListResponse({completionId:t.completionId,errCode:u.Nil,fsoList:n})}catch(e){this.handleError(e,C.CLIENT_ERROR)}}toFso(e){return{lastModified:BigInt(e.lastModified),fileType:"file"===e.kind?p.File:p.Directory,size:BigInt(e.size),isEmpty:e.isEmpty,path:e.path}}send(e){if(this.socket&&1===this.socket.readyState)try{this.socket.send(e)}catch(e){this.handleError(e,C.CLIENT_ERROR)}else this.handleError(new Error("websocket unavailable"),C.CLIENT_ERROR)}sendUsername(e){this.send(this.codec.encodeUsername(e))}sendMouseMove(e,t){this.send(this.codec.encodeMouseMove(e,t))}sendMouseButton(e,t){this.send(this.codec.encodeMouseButton(e,t))}sendMouseWheelScroll(e,t){this.send(this.codec.encodeMouseWheelScroll(e,t))}sendKeyboardInput(e,t){const r=this.codec.encodeKeyboardInput(e,t);r&&this.send(r)}sendClipboardData(e){this.send(this.codec.encodeClipboardData(e))}sendWebAuthn(e){const t=this.codec.encodeMfaJson({mfaType:"n",jsonString:JSON.stringify(e)});this.send(t)}addSharedDirectory(e){try{this.sdManager.add(e)}catch(e){this.handleError(e,C.CLIENT_ERROR)}}sendSharedDirectoryAnnounce(){let e;try{e=this.sdManager.getName(),this.send(this.codec.encodeSharedDirectoryAnnounce({completionId:0,directoryId:2,name:e}))}catch(e){this.handleError(e,C.CLIENT_ERROR)}}sendSharedDirectoryInfoResponse(e){this.send(this.codec.encodeSharedDirectoryInfoResponse(e))}sendSharedDirectoryListResponse(e){this.send(this.codec.encodeSharedDirectoryListResponse(e))}sendSharedDirectoryMoveResponse(e){this.send(this.codec.encodeSharedDirectoryMoveResponse(e))}sendSharedDirectoryReadResponse(e){this.send(this.codec.encodeSharedDirectoryReadResponse(e))}sendSharedDirectoryWriteResponse(e){this.send(this.codec.encodeSharedDirectoryWriteResponse(e))}sendSharedDirectoryCreateResponse(e){this.send(this.codec.encodeSharedDirectoryCreateResponse(e))}sendSharedDirectoryDeleteResponse(e){this.send(this.codec.encodeSharedDirectoryDeleteResponse(e))}resize(e){this.send(this.codec.encodeClientScreenSpec(e))}handleError(e,t){var r;this.logger.error(e),this.emit(t,e),null===(r=this.socket)||void 0===r||r.close()}handleWarning(e,t){this.logger.warn(e),this.emit(t,e)}nuke(){var e;this.removeAllListeners(),null===(e=this.socket)||void 0===e||e.close()}}!function(e){e.TOGGLE_PLAY_PAUSE="play/pause",e.PLAY_SPEED="speed"}(m||(m={})),function(e){e.TOGGLE_PLAY_PAUSE="play/pause",e.PLAY_SPEED="speed",e.UPDATE_CURRENT_TIME="time",e.SESSION_END="end",e.PLAYBACK_ERROR="playback error"}(T||(T={}));class I extends A{constructor(e){var t,r,n;super(e),t=this,r="textDecoder",n=new TextDecoder,r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}togglePlayPause(){this.send(JSON.stringify({action:m.TOGGLE_PLAY_PAUSE})),this.emit(T.TOGGLE_PLAY_PAUSE)}setPlaySpeed(e){this.send(JSON.stringify({action:m.PLAY_SPEED,speed:e})),this.emit(T.PLAY_SPEED,e)}async processMessage(e){const t=JSON.parse(this.textDecoder.decode(e));if("end"===t.message)this.emit(T.SESSION_END);else if("error"===t.message)this.emit(T.PLAYBACK_ERROR,new Error(t.errorText));else{const e=t.ms;this.emit(T.UPDATE_CURRENT_TIME,e),await super.processMessage((0,i.RG)(t.message))}}handleClientScreenSpec(e){this.emit(C.TDP_CLIENT_SCREEN_SPEC,this.codec.decodeClientScreenSpec(e))}handleMouseButton(e){}handleMouseMove(e){}}},9175:(e,t,r)=>{r.d(t,{by:()=>n,wS:()=>s,y2:()=>o});const n={START:"session.start",JOIN:"session.join",END:"session.end",PRINT:"print",RESIZE:"resize"},o={RESIZE:"terminal.resize",CLOSE:"terminal.close",RESET:"terminal.reset",SESSION:"terminal.new_session",DATA:"terminal.data",CONN_CLOSE:"connection.close",WEBAUTHN_CHALLENGE:"terminal.webauthn"},s={NORMAL:1e3}}}]);