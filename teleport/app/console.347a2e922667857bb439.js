"use strict";(self.webpackChunk_gravitational_teleport=self.webpackChunk_gravitational_teleport||[]).push([[290],{2030:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(2784),o=r(7849),s=r(8197);const i=["label","labelTip","value","onChange","onKeyPress","placeholder","defaultValue","min","max","rule","type","autoFocus","autoComplete","inputMode","readonly"];function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}const l=(0,n.forwardRef)(((e,t)=>{let{label:r,labelTip:l,value:d,onChange:p,onKeyPress:f,placeholder:h,defaultValue:m,min:g,max:b,rule:y=c,type:v="text",autoFocus:O=!1,autoComplete:w="off",inputMode:E="text",readonly:C=!1}=e,x=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,i);const{valid:P,message:S}=(0,s.kQ)(y(d)),D=!P,k=D?S:r,j=n.createElement(o.II,{mt:1,ref:t,type:v,hasError:D,placeholder:h,autoFocus:O,value:d,min:g,max:b,autoComplete:w,onChange:p,onKeyPress:f,readOnly:C,inputMode:E,defaultValue:m});return n.createElement(o.xu,a({mb:"4"},x),r?n.createElement(o.SO,{mb:0,hasError:D},k,l&&n.createElement(u,{text:l}),j):j)})),c=()=>()=>({valid:!0}),u=e=>{let{text:t}=e;return n.createElement(o.xv,{as:"span",style:{fontWeight:"normal"}},` - ${t}`)},d=l},3937:(e,t,r)=>{r.d(t,{j2:()=>f,Oq:()=>c,sN:()=>n.sN,ZH:()=>n.ZH});var n=r(2760),o=r(2784),s=r(7849),i=r(3757);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class c extends o.Component{constructor(e){super(e),l(this,"anchorEl",null),l(this,"state",{open:!1}),l(this,"onOpen",(e=>{e.stopPropagation(),this.setState({open:!0})})),l(this,"onClose",(()=>{this.setState({open:!1})})),this.state.open=e.defaultOpen||!1}render(){const{open:e}=this.state,{children:t,buttonIconProps:r,menuProps:l}=this.props;return o.createElement(o.Fragment,null,o.createElement(s.Ei,a({},r,{setRef:e=>this.anchorEl=e,onClick:this.onOpen,"data-testid":"button"}),o.createElement(i.mH4,null)),o.createElement(n.ZP,a({menuListCss:u,anchorEl:this.anchorEl,open:e,onClose:this.onClose,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},l),e&&this.renderItems(t)))}renderItems(e){return o.Children.toArray(e).map((e=>o.cloneElement(e,{onClick:this.makeOnClick(e.props.onClick)})))}makeOnClick(e){return t=>{t.stopPropagation(),this.onClose(),e&&e(t)}}}const u=()=>"\n  min-width: 100px;\n";function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d.apply(this,arguments)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class f extends o.Component{constructor(e){super(e),p(this,"anchorEl",null),p(this,"state",{open:!1}),p(this,"onOpen",(e=>{e.stopPropagation(),this.setState({open:!0})})),p(this,"onClose",(()=>{this.setState({open:!1})})),this.state.open=e.defaultOpen||!1}render(){const{open:e}=this.state,{children:t,menuProps:r,buttonProps:a}=this.props;return o.createElement(o.Fragment,null,o.createElement(s.ku,d({height:"24px",size:"small",setRef:e=>this.anchorEl=e,onClick:this.onOpen},a),"OPTIONS",o.createElement(i.E_,{ml:2,mr:-2,fontSize:"2",color:"text.secondary"})),o.createElement(n.ZP,d({getContentAnchorEl:null,menuListCss:h,anchorEl:this.anchorEl,open:e,onClose:this.onClose,transformOrigin:{vertical:"top",horizontal:"right"},anchorOrigin:{vertical:"center",horizontal:"right"}},r),e&&this.renderItems(t)))}renderItems(e){return o.Children.toArray(e).map((e=>o.cloneElement(e,{onClick:this.makeOnClick(e.props.onClick)})))}makeOnClick(e){return t=>{t.stopPropagation(),this.onClose(),e&&e(t)}}}const h=()=>"\n  min-width: 100px;\n"},8197:(e,t,r)=>{r.d(t,{ZP:()=>p,kQ:()=>d});var n=r(9259),o=r.n(n),s=r(2784),i=r(2418);const a=i.Z.create("validation");class l{constructor(){var e;(e="valid")in this?Object.defineProperty(this,e,{value:true,enumerable:!0,configurable:!0,writable:!0}):this[e]=true,this._subs=[]}subscribe(e){this._subs.push(e)}unsubscribe(e){const t=this._subs.indexOf(e);t>-1&&this._subs.splice(t,1)}addResult(e){let t=!1;o()(e)?t=e.valid:a.error("rule should return a valid object"),this.valid=this.valid&&Boolean(t)}reset(){this.valid=!0,this.validating=!1}validate(){return this.reset(),this.validating=!0,this._subs.forEach((e=>{try{e()}catch(e){a.error(e)}})),this.valid}}const c=s.createContext({}),u=i.Z.create("validation");function d(e){if("function"!=typeof e)return void u.warn("useRule(fn), fn() must be a function");const[,t]=s.useState(),r=function(){const e=s.useContext(c);return e instanceof l||a.warn("Missing Validation Context declaration"),e}();return s.useEffect((()=>{function n(){if(r.validating){const n=e();r.addResult(n),t({})}}return r.subscribe(n),function(){r.unsubscribe(n)}}),[e]),r.validating?e():{valid:!0}}const p=function(e){const[t]=s.useState((()=>new l)),r="function"==typeof e.children?e.children({validator:t}):e.children;return s.createElement(c.Provider,{value:t},r)}},7097:(e,t,r)=>{r.d(t,{Sb:()=>o,el:()=>i,lp:()=>n,qQ:()=>s});const n=e=>t=>()=>{const r=!(!t||0===t.length);return{valid:r,message:r?"":e}},o=e=>()=>e&&0!==e.length?{valid:!0}:{valid:!1,message:"Token is required"},s=e=>()=>!e||e.length<6?{valid:!1,message:"Enter at least 6 characters"}:{valid:!0},i=e=>t=>()=>t?t!==e?{valid:!1,message:"Password does not match"}:{valid:!0}:{valid:!1,message:"Please confirm your password"}},1527:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(917),o=r(7849),s=(r(7757),r(7559));const i=(0,n.ZP)(o.xu)((()=>`\n  height: 100%;\n  width: 100%;\n  overflow: hidden;\n\n  .terminal .xterm-viewport {\n    background-color: ${s.O.bgTerminal} !important;\n  }\n`))},7559:(e,t,r)=>{r.d(t,{O:()=>n});const n={dark:"#000",light:"#fff",subtle:"#CFD8DC",inverse:"#B0BEC5",link:"#039BE5",error:"#FF1744",terminal:"#28FE14",terminalDark:"#01172C",bgTerminal:"#010B1C",primary:{light:"#03203C",lighter:"#092F52",dark:"#01172C",main:"#010B1C"},text:"#263238",success:"#00BFA5",progressBarColor:"#00BFA5"}},7830:(e,t,r)=>{r.r(t),r.d(t,{default:()=>qt});var n=r(2784),o=r(917),s=r(7849);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a extends n.Component{constructor(e){super(e),i(this,"_timerId",null),i(this,"_request",null),this._intervalTime=e.time||3e3}fetch(){this._request||(this._request=this.props.onFetch().finally((()=>{this._request=null})))}componentDidMount(){this.props.immediately&&this.fetch(),this._timerId=setInterval(this.fetch.bind(this),this._intervalTime)}componentWillUnmount(){clearInterval(this._timerId),this._request&&this._request.abort&&this._request.abort()}render(){return null}}i(a,"defaultProps",{immediately:!0});const l=a;var c=r(2566);const u=n.createContext(null),d=e=>n.createElement(u.Provider,e);function p(){const e=n.useContext(u);return window.teleconsole=e,e}var f=r(7559),h=r(2865),m=r(3757),g=r(4073),b=r.n(g),y=r(8394),v=r(135);const O=o.ZP.div(["display:flex;width:16px;height:16px;font-size:11px;font-weight:bold;overflow:hidden;align-items:center;flex-shrink:0;border-radius:50%;justify-content:center;margin-right:3px;background-color:",";"],(e=>e.active?v.Z.colors.accent:v.Z.colors.grey[900])),w=o.ZP.div(["background:",";color:",";border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:12px;font-weight:bold;height:24px;margin-right:16px;width:24px;"],(e=>e.theme.colors.accent),(e=>e.theme.colors.light)),E=o.ZP.div(["border-bottom:1px solid ",";color:",";font-size:12px;align-items:center;display:flex;padding:8px;&:last-child{border:none;}"],v.Z.colors.grey[50],v.Z.colors.grey[600]),C=function(e){const{active:t,users:r,open:o=!1,ml:i,mr:a}=e,l=n.useRef(null),[c,u]=n.useState(o),d=n.useMemo((()=>b()((()=>u(!0)),300)),[]);function p(){d.cancel(),u(!1)}if(r.length<2)return null;const f=r.map(((e,t)=>{const r=(e.user||"").trim().charAt(0).toUpperCase();return n.createElement(E,{key:`${t}${e.user}`},n.createElement(w,null,r),e.user)}));return n.createElement(O,{active:t,ml:i,mr:a,ref:l,onMouseLeave:p,onMouseEnter:function(){d.cancel(),d()}},r.length,n.createElement(y.Z,{open:c,anchorEl:l.current,onClose:p,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},n.createElement(s.xu,{minWidth:"200px",bg:"white",borderRadius:"8px",onMouseLeave:p},f)))};function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e){const{name:t,users:r,active:o,onClick:i,onClose:a,style:l}=e;return n.createElement(k,{alignItems:"center",active:o,style:l},n.createElement(j,{onClick:i},n.createElement(C,{mr:"1",users:r,active:o}),n.createElement(s.xv,{mx:"auto",title:t},t)),n.createElement(T,{title:"Close",onClick:a},n.createElement(m.x8P,null)))}const k=(0,o.ZP)(s.kC)(["max-width:200px;height:100%;",""],(function(e){let{theme:t,active:r}=e,n={border:"none",borderRight:`1px solid ${t.colors.bgTerminal}`,"&:hover, &:focus":{color:t.colors.primary.contrastText,transition:"color .3s"}};return r&&(n=P(P({},n),{},{backgroundColor:t.colors.bgTerminal,color:t.colors.primary.contrastText,fontWeight:"bold",transition:"none"})),n})),j=o.ZP.button(["display:flex;flex:1;align-items:center;cursor:pointer;text-decoration:none;outline:none;margin:0;text-decoration:none;color:inherit;line-height:32px;background-color:transparent;white-space:nowrap;overflow:hidden;padding:0 16px;text-overflow:ellipsis;border:none;"]),T=o.ZP.button(["background:transparent;border-radius:2px;border:none;cursor:pointer;height:16px;width:16px;outline:none;padding:0;margin:0 8px 0 0;transition:all 0.3s;&:hover{background:",";}",""],(e=>e.theme.colors.danger),h.Dh),_=["items","parties","activeTab","onSelect","onClose","onNew","disableNew"];function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},I.apply(this,arguments)}function Z(e){const{items:t,parties:r,activeTab:o,onSelect:i,onClose:a,onNew:l,disableNew:c}=e,u=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,_),d=t.filter((e=>"blank"!==e.kind)).map((e=>{const t=e.id===o;let s=[];return"terminal"===e.kind&&(s=r[e.sid]||[]),n.createElement(D,{name:e.title,key:e.id,users:s,active:t,onClick:()=>i(e),onClose:()=>a(e),style:{flex:"1",flexBasis:"0",flexGrow:"1"}})}));return n.createElement(A,I({as:"nav",typography:"h5",color:"text.secondary",bold:!0},u),d,d.length>0&&n.createElement(s.Ei,{ml:"2",size:0,disabled:c,title:"New Tab",onClick:l},n.createElement(m.mm_,{fontSize:"16px"})))}const A=(0,o.ZP)(s.xu)(["background:",";min-height:32px;border-radius:4px;display:flex;flex-wrap:no-wrap;align-items:center;flex-shrink:0;overflow:hidden;",""],f.O.terminalDark,h.cp),N=function(e){const t=p();return(0,c.o)(t.storeParties),n.createElement(Z,I({},e,{parties:t.storeParties.state}))};var R=r(7933),z=r(3937),L=r(7278);const B={menuListCss:()=>"\n  width: 250px;\n"},U=function(e){return n.createElement(s.kC,{alignItems:"center"},n.createElement(z.Oq,{buttonIconProps:{mr:2,ml:2,size:0,style:{fontSize:"16px"}},menuProps:B},n.createElement(z.sN,{as:R.OL,to:L.Z.routes.root},n.createElement(z.ZH,{as:m.SK8,mr:"2"}),"Main"),n.createElement(z.sN,null,n.createElement(s.DF,{my:3,block:!0,onClick:e.onLogout},"Sign Out"))))};var F,M=r(9124);!function(e){e.Download="Download",e.Upload="Upload"}(F||(F={}));var q=r(8227),H=r(2030),K=r(7097),$=r(8197);function W(){return W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W.apply(this,arguments)}const V=o.ZP.form.attrs((()=>({"aria-label":"form"})))([""]),G=(0,n.forwardRef)(((e,t)=>{function r(e){const t=e.target.value;e.target.value="",e.target.value=t}return n.createElement($.ZP,null,(o=>{let{validator:s}=o;return n.createElement(J,W({},e,{onFocus:r,ref:t,spellCheck:!1,mb:0,mt:0,width:"100%",onBlur:()=>s.validate(),rule:(0,K.lp)("Path is required")}))}))})),J=(0,o.ZP)(H.Z)(["input{border:1px solid rgba(255,255,255,0.1);background:transparent;color:white;box-shadow:none;font-size:14px;height:32px;}"]);function X(e){const[t,r]=(0,n.useState)("~/"),o=!t.endsWith("/");return n.createElement(V,{onSubmit:r=>{r.preventDefault(),e.onAddDownload(t)}},n.createElement(s.kC,{alignItems:"end"},n.createElement(G,{label:"File Path",autoFocus:!0,onChange:e=>r(e.target.value),value:t}),n.createElement(q.DF,{ml:2,px:3,size:"medium",title:"Download",disabled:!o,type:"submit"},"Download")))}function Q(e){const t=(0,n.useRef)(),r=(0,n.useRef)(),[o,i]=(0,n.useState)("~/");function a(t){t.forEach((t=>{e.onAddUpload(o,t)}))}function l(){r.current.value="",r.current.click()}function c(e){e.currentTarget.style.removeProperty("background-color")}const u=!o;return n.createElement(V,null,n.createElement(G,{label:"Upload destination",value:o,autoFocus:!0,onChange:e=>i(e.target.value),onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),l())}}),n.createElement(ee,{ref:r,disabled:u,type:"file","data-testid":"file-input",multiple:!0,accept:"*.*",onChange:function(e){a(Array.from(e.target.files))}}),n.createElement(Y,{disabled:u,ref:t,onDragOver:e=>{e.preventDefault(),function(e){e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.1)"}(e)},onDragLeave:c,onDrop:function(e){c(e);const{files:t}=e.dataTransfer;e.preventDefault(),e.stopPropagation(),a(Array.from(t))},onClick:e=>{e.preventDefault(),l()}},n.createElement(m.xX_,{fontSize:10,mb:2}),n.createElement(s.xv,{typography:"h6"},"Drag your files here"),n.createElement(s.xv,{typography:"body2"},"or Browse your computer to start uploading")))}const Y=o.ZP.button(["display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;color:inherit;background-color:rgba(255,255,255,0.05);margin-top:","px;border:1px dashed rgba(255,255,255,0.1);height:128px;text-align:center;cursor:pointer;opacity:",";pointer-events:",";border-radius:","px;font-family:inherit;:focus{border-color:",";}"],(e=>e.theme.space[3]),(e=>e.disabled?.7:1),(e=>e.disabled?"none":"unset"),(e=>e.theme.radii[2]),(e=>e.theme.colors.action.selected));var ee=(0,o.ZP)("input")(["display:none;"]);function te(e){const{name:t,transferState:r,id:o}=e.file;return(0,n.useEffect)((()=>()=>e.onCancel(o)),[e.onCancel]),n.createElement(oe,null,n.createElement(s.kC,{justifyContent:"space-between",alignItems:"center"},n.createElement(s.kC,{alignItems:"center"},n.createElement(ae,{typography:"body2"},t),"completed"===r.type&&n.createElement(m.yGk,{ml:2,fontSize:"14px",color:"progressBarColor",title:"Transfer completed"})),"processing"===r.type&&n.createElement(s.Ei,{title:"Cancel",size:0,mt:"-4px",mb:"-4px",onClick:()=>e.onCancel(o)},n.createElement(m.X1q,null))),("processing"===r.type||"error"===r.type)&&n.createElement(s.kC,{alignItems:"baseline",mt:1},n.createElement(ne,{mr:1},r.progress,"%"),n.createElement(se,null,n.createElement(ie,{progress:r.progress,isFailure:"error"===r.type}))),"error"===r.type&&n.createElement(re,null,r.error.message))}const re=e=>n.createElement(s.xv,{color:"error.light",typography:"body2",mt:1},n.createElement(m.v3j,{mr:1,color:"inherit"}),e.children),ne=(0,o.ZP)(s.xv)(["line-height:16px;width:36px;"]),oe=o.ZP.li(["list-style:none;margin-top:","px;font-size:","px;"],(e=>e.theme.space[3]),(e=>e.theme.fontSizes[1])),se=o.ZP.div(["border-radius:50px;background:rgba(255,255,255,0.05);width:100%;"]),ie=o.ZP.div(["border-radius:50px;background:",";height:8px;width:","%;"],(e=>e.isFailure?e.theme.colors.disabled:e.theme.colors.progressBarColor),(e=>e.progress));var ae=(0,o.ZP)(s.xv)(["word-break:break-all;"]);function le(e){return e.files.length?n.createElement(ce,null,e.files.map((t=>n.createElement(te,{key:t.id,file:t,onCancel:e.onCancel})))):null}const ce=o.ZP.ul(["padding-left:0;overflow:auto;max-height:300px;margin-top:0;margin-bottom:0;padding-right:16px;margin-right:-16px;"]);function ue(e){const t=e.openedDialog===F.Download?{header:"Download Files",Form:n.createElement(X,{onAddDownload:e.onAddDownload})}:{header:"Upload Files",Form:n.createElement(Q,{onAddUpload:e.onAddUpload})};return n.createElement(pe,{"data-testid":"file-transfer-container",backgroundColor:e.backgroundColor,onKeyDown:t=>{"Escape"===t.key&&(t.preventDefault(),t.stopPropagation(),e.onClose())}},n.createElement(s.kC,{justifyContent:"space-between",alignItems:"baseline"},n.createElement(s.xv,{fontSize:3,bold:!0,mb:3},t.header),n.createElement(de,{onClick:e.onClose})),t.Form,n.createElement(le,{files:e.files,onCancel:e.onCancel}))}function de(e){return n.createElement(s.Ei,{title:"Close",onClick:e.onClick},n.createElement(m.x8P,null))}const pe=o.ZP.div(["background:",";box-shadow:0 8px 32px rgba(0,0,0,0.1);box-sizing:border-box;border-radius:","px;padding:8px 16px 16px;position:absolute;right:8px;top:8px;width:500px;z-index:10;"],(e=>e.backgroundColor||e.theme.colors.primary.light),(e=>e.theme.radii[2])),fe=n.createContext(null),he=e=>{const[t,r]=(0,n.useState)(e.openedDialog);return n.createElement(fe.Provider,{value:{openedDialog:t,openDownloadDialog:function(){r(F.Download)},openUploadDialog:function(){r(F.Upload)},closeDialog:function(){r(void 0)}},children:e.children})},me=()=>{const e=(0,n.useContext)(fe);if(!e)throw new Error("FileTransfer requires FileTransferContextProvider context.");return e};function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){ye(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ye(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ve={ids:[],filesById:{}};function Oe(e,t){switch(t.type){case"add":return{ids:[t.payload.id,...e.ids],filesById:be(be({},e.filesById),{},{[t.payload.id]:be(be({},t.payload),{},{transferState:{type:"processing",progress:0}})})};case"updateTransferState":{const r=()=>{if("error"===t.payload.transferState.type){const{transferState:r}=e.filesById[t.payload.id];return be(be({},t.payload.transferState),{},{progress:"processing"===r.type?r.progress:0})}return t.payload.transferState};return be(be({},e),{},{filesById:be(be({},e.filesById),{},{[t.payload.id]:be(be({},e.filesById[t.payload.id]),{},{transferState:r()})})})}default:throw new Error("Unhandled action",t)}}function we(e){const{openedDialog:t,closeDialog:r}=me();return t?n.createElement(Ee,{openedDialog:t,backgroundColor:e.backgroundColor,transferHandlers:e.transferHandlers,onCloseDialog:async function(t){const n=()=>{var t;r(),null===(t=e.afterClose)||void 0===t||t.call(e)};t&&e.beforeClose?await e.beforeClose()&&n():n()}}):null}function Ee(e){const t=(()=>{const[e,t]=(0,n.useReducer)(Oe,ve),r=(0,n.useRef)(new Map),o=(0,n.useCallback)(((e,r)=>{t({type:"updateTransferState",payload:{id:e,transferState:r}})}),[]),s=(0,n.useCallback)((e=>{var t;null===(t=r.current)||void 0===t||t.get(e).abort()}),[]),i=(0,n.useMemo)((()=>e.ids.map((t=>e.filesById[t]))),[e.ids,e.filesById]),a=(0,n.useCallback)((()=>i.some((e=>"processing"===e.transferState.type))),[i]);return{files:i,start:async e=>{const n=new AbortController,s=await e.runFileTransfer(n);if(!s)return;const i=(new Date).getTime()+e.name;t({type:"add",payload:{id:i,name:e.name}}),r.current.set(i,n),s.onProgress((e=>{o(i,{type:"processing",progress:e})})),s.onError((e=>{o(i,{type:"error",progress:void 0,error:e})})),s.onComplete((()=>{o(i,{type:"completed"})}))},cancel:s,isAnyTransferInProgress:a}})();return n.createElement(ue,{openedDialog:e.openedDialog,files:t.files,onCancel:t.cancel,backgroundColor:e.backgroundColor,onClose:function(){e.onCloseDialog(t.isAnyTransferInProgress())},onAddUpload:function(r,n){t.start({name:n.name,runFileTransfer:t=>e.transferHandlers.getUploader(r,n,t)})},onAddDownload:function(r){t.start({name:r,runFileTransfer:t=>e.transferHandlers.getDownloader(r,t)})}})}function Ce(e){let{isConnected:t}=e;const r=me(),o=r.openedDialog||!t;return n.createElement(s.kC,{flex:"none",alignItems:"center",height:"24px"},n.createElement(s.Ei,{disabled:o,size:0,title:"Download files",onClick:r.openDownloadDialog},n.createElement(m.UWx,{fontSize:"16px"})),n.createElement(s.Ei,{disabled:o,size:0,title:"Upload files",onClick:r.openUploadDialog},n.createElement(m.gqx,{fontSize:"16px"})))}var xe=r(2699);function Pe(){const e=new xe.EventEmitter;return{emitProgress:t=>{e.emit("progress",t)},emitComplete:()=>{e.emit("complete")},emitError:t=>{e.emit("error",t)},onProgress:t=>{e.on("progress",t)},onComplete:t=>{e.on("complete",t)},onError:t=>{e.on("error",t)}}}var Se=r(4523),De=r(2070);const ke=["visible","children"];function je(){return je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},je.apply(this,arguments)}const Te=e=>{let{visible:t,children:r}=e,o=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,ke);return n.createElement(s.kC,je({flex:"1",style:{overflow:"auto",background:f.O.bgTerminal,display:t?"flex":"none",position:"relative"}},o),r)};var _e=r(3958),Ie=r(6209);function Ze(e){const t=["1","2","3","4","5","6","7","8","9"].indexOf(e.key),{isMac:r}=(0,_e.Z)();let n;return(r&&e.ctrlKey||e.altKey)&&-1!==t&&(n={index:t}),{tabSwitch:n}}var Ae=r(1527);function Ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Re extends n.Component{constructor(){super(...arguments),Ne(this,"terminal",void 0),Ne(this,"refTermContainer",n.createRef())}componentDidMount(){const e=(0,_e.Z)().isMac?12:14;this.terminal=new Ie.Z(this.props.tty,{el:this.refTermContainer.current,fontFamily:this.context.fonts.mono,fontSize:e}),this.terminal.open(),this.terminal.term.attachCustomKeyEventHandler((e=>{const{tabSwitch:t}=Ze(e);if(t)return!1}))}componentWillUnmount(){this.terminal.destroy()}shouldComponentUpdate(){return!1}focus(){this.terminal.term.focus()}render(){return n.createElement(s.kC,{flexDirection:"column",height:"100%",width:"100%",px:"2",style:{overflow:"auto"}},n.createElement(Ae.Z,{ref:this.refTermContainer}))}}Ne(Re,"contextType",o.Ni);const ze=Re;var Le=r(9175);var Be=r(1452);function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(r),!0).forEach((function(t){Me(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Me(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qe(){return{upload(e,t,r){const n=Pe(),o=He({method:"post",url:e,eventEmitter:n,abortController:r,transformFailedResponse:()=>Ke(o.response)});return o.upload.addEventListener("progress",(e=>{n.emitProgress($e(e))})),o.send(t),n},download(e,t){const r=Pe(),n=He({method:"get",url:e,eventEmitter:r,abortController:t,transformSuccessfulResponse:()=>{const e=function(e){let t="";const r=e.getResponseHeader("Content-Disposition");if(r){const e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(r);null!=e&&e[1]&&(t=e[1].replace(/['"]/g,""))}return decodeURIComponent(t)}(n);if(!e)throw new Error("Bad response");!function(e,t){const r=document.createElement("a");r.href=window.URL.createObjectURL(t),r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)}(e,n.response)},transformFailedResponse:()=>{return e=n.response,new Promise((t=>{const r=new FileReader;r.onerror=()=>{t(r.error.message)},r.onload=()=>{const e=Ke(r.result);t(e)},r.readAsText(e)}));var e}});return n.onprogress=e=>{200===n.status&&r.emitProgress($e(e))},n.responseType="blob",n.send(),r}}}function He(e){let{method:t,url:r,abortController:n,eventEmitter:o,transformSuccessfulResponse:s,transformFailedResponse:i}=e;const a=new XMLHttpRequest;return a.open(t,r,!0),function(){const e=Fe(Fe({},(0,Be.g0)()),(0,Be.EC)());Object.keys(e).forEach((t=>{a.setRequestHeader(t,e[t])}))}(),n&&(n.signal.onabort=()=>{a.abort()}),a.onload=async()=>{if(200===a.status)try{null==s||s(),o.emitComplete()}catch(e){o.emitError(e)}else o.emitError(new Error(await i()))},a.onerror=async()=>{o.emitError(new Error(await i()))},a.ontimeout=()=>{o.emitError(new Error("Request timed out."))},a.onabort=()=>{o.emitError(new DOMException("Aborted","AbortError"))},a}function Ke(e){const t="Bad request";if(!e)return t;try{var r;const n=JSON.parse(e);return(null===(r=n.error)||void 0===r?void 0:r.message)||n.message||t}catch(e){return"Bad request, failed to parse error message."}}function $e(e){if(e.lengthComputable)return Math.round(e.loaded/e.total*100);{const t=e.loaded,r=e.total;return Math.floor(t/r*1e3)/10}}const We=e=>{let{sid:t="",clusterId:r=""}=e;return n.createElement(s.xu,{my:10,mx:"auto",width:"300px"},n.createElement(s.xv,{typography:"h4",mb:"3",textAlign:"center"},"The session is no longer active"),n.createElement(s.DF,{block:!0,secondary:!0,as:"a",href:L.Z.getPlayerRoute({sid:t,clusterId:r},{recordingType:"ssh"}),target:"_blank"},n.createElement(m.rNN,{fontSize:"5",mr:"2"})," Replay Session"))},Ve=function(e){let{doc:t,visible:r}=e;const o=(0,n.useRef)(),{tty:i,status:a,statusText:l,closeDocument:c}=function(e){const{clusterId:t,sid:r,serverId:o,login:s}=e,i=p(),a=n.useRef(null),l=a.current,[c,u]=n.useState(null),[d,f]=n.useState(""),[h,m]=n.useState("loading");return n.useEffect((()=>{function n(t){const r=i.createTty(t);r.on(Le.y2.CLOSE,(()=>i.closeTab(e))),r.on(Le.y2.CONN_CLOSE,(()=>i.updateSshDocument(e.id,{status:"disconnected"}))),r.on("open",(()=>function(e,t,r){const{resourceName:n,login:o,sid:s,clusterId:i,serverId:a,created:l}=t,c=L.Z.getSshSessionRoute({sid:s,clusterId:i});e.updateSshDocument(r,{title:`${o}@${n}`,status:"connected",url:c,serverId:a,created:l,login:o,sid:s,clusterId:i}),e.gotoTab({url:c})}(i,t,e.id))),a.current=r,u(t),m("initialized")}return r?i.fetchSshSession(t,r).then(n).catch((e=>{m("notfound"),f(e.message)})):i.createSshSession(t,o,s).then(n).catch((e=>{m("error"),f(e.message)})),function(){a.current&&a.current.removeAllListeners()}}),[]),{tty:l,status:h,statusText:d,session:c,closeDocument:function(){i.closeTab(e)}}}(t),u=(0,De.Z)(i);return(0,n.useEffect)((()=>{o&&o.current&&o.current.terminal.term.focus()}),[r,u.requested]),n.createElement(Te,{visible:r,flexDirection:"column"},n.createElement(he,null,n.createElement(Ce,{isConnected:"connected"===t.status}),"loading"===a&&n.createElement(s.xu,{textAlign:"center",m:10},n.createElement(s.z$,null)),"error"===a&&n.createElement(M.b0,{mx:"10",mt:"5"},"Connection error: ",l),"notfound"===a&&n.createElement(We,{sid:t.sid,clusterId:t.clusterId}),u.requested&&n.createElement(Se.Z,{onContinue:u.authenticate,onCancel:c,errorText:u.errorText}),"initialized"===a&&n.createElement(ze,{tty:i,ref:o}),n.createElement(we,{beforeClose:()=>window.confirm("Are you sure you want to cancel file transfers?"),afterClose:function(){o.current.terminal.term.focus()},backgroundColor:f.O.primary.light,transferHandlers:{getDownloader:async(e,r)=>qe().download(L.Z.getScpUrl({location:e,clusterId:t.clusterId,serverId:t.serverId,login:t.login,filename:e}),r),getUploader:async(e,r,n)=>qe().upload(L.Z.getScpUrl({location:e,clusterId:t.clusterId,serverId:t.serverId,login:t.login,filename:r.name}),r,n)}})))};var Ge=r(6189),Je=r(6900),Xe=r(2499),Qe=r(7038);const Ye=["value","onChange","defaultMenuIsOpen"];const et=(0,o.ZP)(Qe.vf)((e=>{let{theme:t}=e;return`\n  .react-select-container {\n    background: ${t.colors.primary.light};\n  }\n\n  .react-select__single-value {\n    color: white;\n    padding: 0 4px;\n    margin: 0;\n  }\n`})),tt=function(e){let{value:t,onChange:r,defaultMenuIsOpen:o=!1}=e,i=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,Ye);const a=p(),[l,c]=n.useState(null),[u,d]=n.useState([]),f={value:t,label:t};return n.createElement(s.xu,i,n.createElement(s.SO,null," Clusters "),n.createElement(et,null,n.createElement(Qe.qV,{noOptionsMessage:function(){return l?`Error: ${l}`:"No leaf clusters found"},value:f,onChange:function(e){r(e.value)},loadOptions:function(e){let t=Promise.resolve(u);return 0===u.length&&(t=a.fetchClusters().then((e=>e.map((e=>({value:e.clusterId,label:e.clusterId}))))).then((e=>(d(e),e)))),t.then((t=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e=e.toLocaleLowerCase(),t.filter((t=>-1!==t.value.toLocaleLowerCase().indexOf(e)))}(e,t))).catch((e=>{c(e.message)}))},defaultMenuIsOpen:o,hasError:!1,maxMenuHeight:400,isSearchable:!0,isSimpleValue:!1,isClearable:!1,defaultOptions:!0,cacheOptions:!0})))};var rt=r(4517),nt=r(4696),ot=r(1392),st=r(321),it=r(7773),at=r(8604);function lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ct(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(r),!0).forEach((function(t){ut(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ut(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var dt=r(6393);function pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ft(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(r),!0).forEach((function(t){ht(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ht(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const mt=ft(ft({},v.Z),{},{colors:ft(ft({},v.Z.colors),{},{primary:ft(ft({},v.Z.colors.primary),f.O.primary)})}),gt=e=>n.createElement(dt.Z,{theme:mt,children:e.children}),bt=(0,o.ZP)(s.xu)(["flex-direction:column;display:flex;flex:1;max-width:1024px;::after{content:' ';padding-bottom:24px;}"]),yt=function(e){const{doc:t,visible:r}=e,{results:o,fetchNext:i,fetchPrev:a,pageSize:l,from:c,to:u,params:d,setParams:f,startKeys:h,setSort:m,pathname:g,replaceHistory:b,fetchStatus:y,attempt:v,createSshSession:O,changeCluster:w,getNodeSshLogins:E,onLabelClick:C}=function(e){let{clusterId:t,id:r}=e;const o=p(),{search:s,pathname:i}=(0,rt.TH)(),[a,l]=(0,n.useState)([]),{attempt:c,setAttempt:u}=(0,nt.Z)("processing"),[d,f]=(0,n.useState)(""),[h,m]=(0,n.useState)(ct({sort:{fieldName:"hostname",dir:"ASC"}},(0,st.Z)(s))),[g,b]=(0,n.useState)({nodes:[],startKey:"",totalCount:0}),y=g.totalCount>0?15*(a.length-2)+1:0,v=g.totalCount>0?y+g.nodes.length-1:0;function O(e){ot.Z.replace(e)}return(0,n.useEffect)((()=>{u({status:"processing"}),o.fetchNodes(t,ct(ct({},h),{},{limit:15})).then((e=>{let{nodesRes:t}=e;b({nodes:t.agents,startKey:t.startKey,totalCount:t.totalCount}),f(t.startKey?"":"disabled"),l(["",t.startKey]),u({status:"success"})})).catch((e=>{u({status:"failed",statusText:e.message}),b(ct(ct({},g),{},{nodes:[],totalCount:0})),l([""])}))}),[t,s]),{attempt:c,createSshSession:function(e,n){const s=o.getSshDocumentUrl({serverId:n,login:e,clusterId:t});o.gotoTab({url:s}),o.removeDocument(r)},changeCluster:function(e){const t=e,n=o.getNodeDocumentUrl(t);o.storeDocs.update(r,{url:n,clusterId:t}),o.gotoTab({url:n})},getNodeSshLogins:function(e){const r=g.nodes.find((t=>t.id==e));return function(e,t){const r=(null==t?void 0:t.sshLogins)||[];return(0,at.X)(r).map((r=>({login:r,url:o.getSshDocumentUrl({clusterId:e,serverId:(null==t?void 0:t.id)||"",login:r})})))}(t,r)},results:g,fetchNext:()=>{f("loading"),o.fetchNodes(t,ct(ct({},h),{},{limit:15,startKey:g.startKey})).then((e=>{let{nodesRes:t}=e;b(ct(ct({},g),{},{nodes:t.agents,startKey:t.startKey})),f(t.startKey?"":"disabled"),l([...a,t.startKey])})).catch((e=>{u({status:"failed",statusText:e.message})}))},fetchPrev:()=>{f("loading"),o.fetchNodes(t,ct(ct({},h),{},{limit:15,startKey:a[a.length-3]})).then((e=>{let{nodesRes:t}=e;b(ct(ct({},g),{},{nodes:t.agents,startKey:t.startKey}));const r=a;r.pop(),l(r),f(t.startKey?"":"disabled")})).catch((e=>{u({status:"failed",statusText:e.message})}))},pageSize:15,from:y,to:v,params:h,setParams:m,startKeys:a,setSort:function(e){m(ct(ct({},h),{},{sort:e}))},pathname:i,replaceHistory:O,fetchStatus:d,onLabelClick:e=>(0,it.Z)(e,h,m,i,O)}}(t);return n.createElement(gt,null,n.createElement(Te,{visible:r},n.createElement(bt,{mx:"auto",mt:"4",px:"5"},n.createElement(s.kC,{justifyContent:"space-between",mb:"4",alignItems:"end"},n.createElement(tt,{value:t.clusterId,width:"336px",maxMenuHeight:200,mr:"20px",onChange:function(e){w(e)}}),n.createElement(Je.Z,{width:"240px",onPress:function(e,t){O(e,t)}})),"processing"===v.status&&n.createElement(s.xu,{textAlign:"center",m:10},n.createElement(s.z$,null)),"failed"===v.status&&n.createElement(Xe.Z,{message:v.statusText}),"processing"!==v.status&&n.createElement(Ge.Z,{nodes:o.nodes,totalCount:o.totalCount,onLoginMenuOpen:function(e){return E(e)},onLoginSelect:function(e,t,r){e.ctrlKey||e.metaKey||(e.preventDefault(),O(t,r))},fetchNext:i,fetchPrev:a,fetchStatus:y,from:c,to:u,pageSize:l,params:d,setParams:f,startKeys:h,setSort:m,pathname:g,replaceHistory:b,onLabelClick:C}))))},vt=function(e){const{visible:t,doc:r}=e,o=p();return n.createElement(Te,{visible:t},n.createElement(s.kC,{flexDirection:"column",alignItems:"center",flex:"1"},n.createElement(m.zlj,{fontSize:"256px",mt:"10",mb:"6",color:f.O.terminalDark}),n.createElement(s.DF,{onClick:function(){o.gotoNodeTab(r.clusterId)},children:"Start a New Session"})))};var Ot=r(4852);function wt(){const e=p(),{verifyAndConfirm:t}=function(e){function t(e){if("terminal"!==e.kind||"connected"!==e.status)return!1;const t=e.created.getTime();return(new Date).getTime()-t>3e4}return n.useEffect((()=>{const r=r=>{Ot.Z.isValid()&&e.getDocuments().some(t)&&(r.preventDefault(),r.returnValue="")};return window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r)}}),[]),{verifyAndConfirm:function(r){if(t(r)){const t=r.sid,n=e.storeParties.state[t];return!n||(n.length>1?window.confirm("Are you sure you want to leave this session?"):window.confirm("Are you sure you want to terminate this session?"))}return!0},hasLastingSshConnection:t}}(e),{clusterId:r,activeDocId:o}=function(e){const{pathname:t}=(0,rt.TH)(),{clusterId:r}=(0,rt.UO)(),o=(0,rt.$B)(L.Z.routes.consoleConnect),s=(0,rt.$B)(L.Z.routes.consoleNodes),i=(0,rt.$B)(L.Z.routes.consoleSession);return n.useMemo((()=>{-1===e.getActiveDocId(t)&&(o?e.addSshDocument(o.params):i?e.addSshDocument(i.params):s&&e.addNodeDocument(r))}),[e,t]),{clusterId:r,activeDocId:e.getActiveDocId(t)}}(e),i=e.storeDocs,a=i.getDocuments(),u=a.find((e=>e.id===o)),d=i.getSshDocuments().length>0;var h;(e=>{n.useEffect((()=>{const t=t=>{const{tabSwitch:r}=Ze(t);if(!r)return;t.preventDefault();const n=e.getDocuments()[r.index+1];n&&e.gotoTab(n)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)}),[])})(e),h=e,(0,c.o)(h.storeDocs),function(e){const t=e&&e.title?`${e.clusterId} • ${e.title}`:"Console";n.useEffect((()=>{document.title=t}),[t])}(u);const m=i.getNodeDocuments().length>0,g=a.map((e=>n.createElement(Et,{doc:e,visible:e.id===o,key:e.id})));return n.createElement(Ct,null,n.createElement(s.kC,{bg:f.O.terminalDark,height:"32px"},n.createElement(N,{flex:"1",items:a,onClose:function(r){t(r)&&e.closeTab(r)},onSelect:function(t){e.gotoTab(t)},activeTab:o,clusterId:r,disableNew:m,onNew:function(){e.gotoNodeTab(r)}}),n.createElement(U,{onLogout:function(){e.logout()}})),g,d&&n.createElement(l,{time:5e3,onFetch:function(){return e.refreshParties()}}))}function Et(e){const{doc:t,visible:r}=e;return n.useMemo((()=>{switch(t.kind){case"terminal":return n.createElement(Ve,{doc:t,visible:r});case"nodes":return n.createElement(yt,{doc:t,visible:r});default:return n.createElement(vt,{doc:t,visible:r})}}),[r,t])}const Ct=o.ZP.div(["background-color:",";bottom:0;left:0;position:absolute;right:0;top:0;display:flex;flex-direction:column;"],f.O.bgTerminal);var xt=r(2418),Pt=r(8005);function St(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?St(Object(r),!0).forEach((function(t){kt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):St(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function kt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class jt{constructor(e){kt(this,"_cfg",{ttyUrl:null,ttyParams:{}}),this._cfg=Dt({},e)}getConnStr(e,t){const{ttyParams:r,ttyUrl:n}=this._cfg,o=JSON.stringify(Dt(Dt({},r),{},{term:{h:t,w:e}})),s=window.encodeURI(o);return n.replace(":params",s)}}var Tt=r(3687),_t=r(1226),It=r(5306);function Zt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function At(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(r),!0).forEach((function(t){Nt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Nt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Rt extends c.y{constructor(){super(...arguments),Nt(this,"state",{items:[]})}add(e){const t=At({id:Math.floor(1e5*Math.random())},e);return this.setState({items:[...this.state.items,t]}),t}update(e,t){const r=this.state.items.map((r=>r.id===e?At(At({},r),t):r));this.setState({items:r})}filter(e){return this.state.items.filter((t=>t.id!==e))}getNext(e){const{items:t}=this.state;for(let r=0;r<t.length;r++)if(t[r].id===e){if(t.length>r+1)return t[r+1].id;if(t.length===r+1&&0!==r)return t[r-1].id}return-1}find(e){return this.state.items.find((t=>t.id===e))}findByUrl(e){return this.state.items.find((t=>t.url===encodeURI(e)))}getNodeDocuments(){return this.state.items.filter((e=>"nodes"===e.kind))}getSshDocuments(){return this.state.items.filter((e=>"terminal"===e.kind&&"connected"===e.status))}getDocuments(){return this.state.items}}class zt extends c.y{constructor(){var e,t;super(...arguments),t={},(e="state")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t}setParties(e){this.setState(e)}bySid(e){return this.state[e]||[]}}function Lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Bt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(r),!0).forEach((function(t){Ut(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ut(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ft=xt.Z.create("teleport/console");class Mt{constructor(){Ut(this,"storeDocs",new Rt),Ut(this,"storeParties",new zt),Ut(this,"nodesService",new _t.Z),this.storeDocs.add({kind:"blank",url:L.Z.getConsoleRoute(L.Z.proxyCluster),clusterId:L.Z.proxyCluster,created:new Date})}getActiveDocId(e){const t=this.storeDocs.findByUrl(e);return t?t.id:-1}removeDocument(e){const t=this.storeDocs.getNext(e),r=this.storeDocs.filter(e);return this.storeDocs.setState({items:r}),this.storeDocs.find(t)}updateSshDocument(e,t){this.storeDocs.update(e,t)}addNodeDocument(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.Z.proxyCluster;return this.storeDocs.add({clusterId:e,title:"New session",kind:"nodes",url:L.Z.getConsoleNodesRoute(e),created:new Date})}addSshDocument(e){let{login:t,serverId:r,sid:n,clusterId:o}=e;const s=t&&r?`${t}@${r}`:n,i=this.getSshDocumentUrl({clusterId:o,login:t,serverId:r,sid:n});return this.storeDocs.add({kind:"terminal",status:"disconnected",clusterId:o,title:s,serverId:r,login:t,sid:n,url:i,created:new Date})}getDocuments(){return this.storeDocs.state.items}getNodeDocumentUrl(e){return L.Z.getConsoleNodesRoute(e)}getSshDocumentUrl(e){return e.sid?L.Z.getSshSessionRoute(e):L.Z.getSshConnectRoute(e)}refreshParties(){const e=this.storeDocs.getSshDocuments().filter((e=>"connected"===e.status)).map((e=>e.clusterId)),t=[...new Set(e)].map((e=>Tt.Z.fetchParticipants({clusterId:e}).catch((e=>(Ft.error("failed to refresh participants",e),{})))));return Promise.all(t).then((e=>{let t={};for(let r=0;r<e.length;r++)t=Bt({},e[r]);this.storeParties.setParties(t)}))}fetchNodes(e,t){return this.nodesService.fetchNodes(e,t).then((e=>({nodesRes:e})))}fetchClusters(){return It.Z.fetchClusters()}fetchSshSession(e,t){return Tt.Z.fetchSession({clusterId:e,sid:t})}createSshSession(e,t,r){return Tt.Z.createSession({serverId:t,clusterId:e,login:r})}logout(){Ot.Z.logout()}createTty(e){const{login:t,sid:r,serverId:n,clusterId:o}=e,s=L.Z.api.ttyWsAddr.replace(":fqdn",(0,Be.Lp)()).replace(":token",(0,Be.hP)()).replace(":clusterId",o),i=new jt({ttyUrl:s,ttyParams:{login:t,sid:r,server_id:n}});return new Pt.Z(i)}gotoNodeTab(e){const t=this.getNodeDocumentUrl(e);this.gotoTab({url:t})}gotoTab(e){let{url:t}=e;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?ot.Z.push(t):ot.Z.replace(t)}closeTab(e){const t=this.removeDocument(e.id);this.gotoTab(t)}}function qt(){const[e]=n.useState((()=>new Mt));return n.createElement(d,{value:e},n.createElement(wt,null))}},4523:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(2784),o=r(9161),s=r(9124),i=r(7849);const a=function(e){let{onContinue:t,onCancel:r,errorText:a}=e;return n.createElement(o.ZP,{dialogCss:()=>({width:"400px"}),open:!0},n.createElement(o.fK,{style:{flexDirection:"column"}},n.createElement(o.$N,{textAlign:"center"},"Verify Your Identity")),n.createElement(o.cZ,{mb:6},a&&n.createElement(s.b0,{mt:2,width:"100%"},a),n.createElement(i.xv,{textAlign:"center"},"Re-authentication is required. Follow the prompts given by your browser to complete authentication.")),n.createElement(o.cN,{textAlign:"center"},n.createElement(i.DF,{onClick:t,mr:3,width:"130px"},a?"Retry":"Verify"),n.createElement(i.PL,{onClick:r},"Cancel")))}},8082:(e,t,r)=>{r.d(t,{j:()=>o});var n=r(2699);class o extends n.EventEmitter{constructor(){super()}sendWebAuthn(e){throw new Error("Not implemented")}}},9175:(e,t,r)=>{r.d(t,{by:()=>n,wS:()=>s,y2:()=>o});const n={START:"session.start",JOIN:"session.join",END:"session.end",PRINT:"print",RESIZE:"resize"},o={RESIZE:"terminal.resize",CLOSE:"terminal.close",RESET:"terminal.reset",DATA:"terminal.data",CONN_CLOSE:"connection.close",WEBAUTHN_CHALLENGE:"terminal.webauthn"},s={NORMAL:1e3}},6209:(e,t,r)=>{r.d(t,{Z:()=>f});var n=r(3363),o=r.n(n),s=r(4073),i=r.n(s),a=(r(7757),r(7289)),l=r(8440),c=r(2418),u=r(9175);function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const p=c.Z.create("lib/term/terminal");class f{constructor(e,t){d(this,"term",void 0),d(this,"tty",void 0),d(this,"_el",void 0),d(this,"_scrollBack",void 0),d(this,"_fontFamily",void 0),d(this,"_fontSize",void 0),d(this,"_debouncedResize",void 0),d(this,"_fitAddon",new l.FitAddon);const{el:r,scrollBack:n,fontFamily:o,fontSize:s}=t;this._el=r,this._fontFamily=o||void 0,this._fontSize=s||14,this._scrollBack=n,this.tty=e,this.term=null,this._debouncedResize=i()((()=>{this._requestResize()}),200)}open(){this.term=new a.Terminal({lineHeight:1,fontFamily:this._fontFamily,fontSize:this._fontSize,scrollback:this._scrollBack||1e3,cursorBlink:!1,allowTransparency:!0}),this.term.loadAddon(this._fitAddon),this.term.open(this._el),this._fitAddon.fit(),this.term.focus(),this.term.onData((e=>{this.tty.send(e)})),this.tty.on(u.y2.RESET,(()=>this.reset())),this.tty.on(u.y2.CONN_CLOSE,(e=>this._processClose(e))),this.tty.on(u.y2.DATA,(e=>this._processData(e))),this.tty.on(u.y2.RESIZE,(e=>{let{h:t,w:r}=e;return this.resize(r,t)})),this.connect(),window.addEventListener("resize",this._debouncedResize)}connect(){this.tty.connect(this.term.cols,this.term.rows)}destroy(){var e;this._disconnect(),this._debouncedResize.cancel(),this._fitAddon.dispose(),this._el.innerHTML=null,null===(e=this.term)||void 0===e||e.dispose(),window.removeEventListener("resize",this._debouncedResize)}reset(){this.term.reset()}resize(e,t){try{if(o()(e)&&o()(t)||(e=this.term.cols,t=this.term.rows),e===this.term.cols&&t===this.term.rows)return;this.term.resize(e,t)}catch(r){p.error("xterm.resize",{w:e,h:t},r),this.term.reset()}}_disconnect(){this.tty.disconnect(),this.tty.removeAllListeners()}_requestResize(){this._el.clientWidth&&this._el.clientHeight?(this._fitAddon.fit(),this.tty.requestResize(this.term.cols,this.term.rows)):p.info("unable to resize terminal (container might be hidden)")}_processData(e){try{this.tty.pauseFlow(),this.term.write(e,(()=>this.tty.resumeFlow()))}catch(t){p.error("xterm.write",e,t),this.term.reset(),this.tty.resumeFlow()}}_processClose(e){const{reason:t}=e;let r="disconnected";t&&(r=`${r}: ${t}`),r=`[31m${r}[m\r\n`,this.term.write(r)}}},8005:(e,t,r)=>{r.d(t,{Z:()=>g});var n=r(2418),o=r(8082),s=r(9175),i=r(8834);const a={RAW:"r",AUDIT:"a",SESSION_END:"c",RESIZE:"w",WEBAUTHN_CHALLENGE:"n"},l={payload:{code:26},version:{code:10,length:1,values:{v1:49}},type:{length:1,code:18,values:{resize:a.RESIZE.charCodeAt(0),data:a.RAW.charCodeAt(0),event:a.AUDIT.charCodeAt(0),close:a.SESSION_END.charCodeAt(0)}}};class c{encode(e,t){var r=[];return this.encodeVersion(r),this.encodeType(r,e),this.encodePayload(r,t),r}encodeResizeMessage(e){return this.encode(l.type.values.resize,e)}encodeRawMessage(e){return this.encode(l.type.values.data,e)}encodePayload(e,t){e.push(l.payload.code);var r=this._textToUintArray(t);this.encodeVarint(e,r.length);for(var n=0;n<r.length;n++)e.push(r[n])}encodeVersion(e){e[0]=l.version.code,e[1]=l.version.length,e[2]=l.version.values.v1}encodeType(e,t){e[3]=l.type.code,e[4]=l.type.length,e[5]=t}encodeVarint(e,t){for(var r=t>>>0,n=Math.floor((t-r)/4294967296)>>>0;n>0||r>127;)e.push(127&r|128),r=(r>>>7|n<<25)>>>0,n>>>=7;e.push(r)}decode(e){return{version:this.decodeVersion(e),type:this.decodeType(e),payload:this.decodePayload(e)}}decodeVersion(e){if(e[0]===l.version.code&&e[1]===l.version.length)return String.fromCharCode(e[2]);throw new Error("invalid version field")}decodeType(e){if(e[3]===l.type.code&&e[4]===l.type.length)return String.fromCharCode(e[5]);throw new Error("invalid type field")}decodePayload(e){if(!e[6])return"";if(e[6]!==l.payload.code)throw new Error("invalid payload field");const t=e.slice(7),[r,n]=this.decodeVarint(t),o=t.slice(r,r+n);return this._uintArrayToText(o)}decodeVarint(e){let t=0,r=0;for(let o=0;o<e.length;o++){var n=e[o];if(n<128){if(o>9||9==o&&n>1)throw new Error("unable to decode varint: overflow");return[o+1,t|n<<r]}t|=n&127<<r,r+=7}throw new Error("unable to decode varint: empty array")}_textToUintArray(e){return i.Buffer(e)}_uintArrayToText(e){return window.TextDecoder?new TextDecoder("utf-8").decode(e):i.Buffer(e).toString()}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice});const f=n.Z.create("Tty"),h={buffered:!0};class m extends o.j{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),p(this,"socket",null),p(this,"_buffered",!0),p(this,"_attachSocketBufferTimer",void 0),p(this,"_attachSocketBuffer",void 0),p(this,"_addressResolver",null),p(this,"_proto",new c);const r=d(d({},h),t);this._addressResolver=e,this._buffered=r.buffered,this._onOpenConnection=this._onOpenConnection.bind(this),this._onCloseConnection=this._onCloseConnection.bind(this),this._onMessage=this._onMessage.bind(this)}disconnect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.wS.NORMAL;null!==this.socket&&this.socket.close(e)}connect(e,t){const r=this._addressResolver.getConnStr(e,t);this.socket=new WebSocket(r),this.socket.binaryType="arraybuffer",this.socket.onopen=this._onOpenConnection,this.socket.onmessage=this._onMessage,this.socket.onclose=this._onCloseConnection}send(e){if(!this.socket||!e)return;const t=this._proto.encodeRawMessage(e),r=new Uint8Array(t);this.socket.send(r.buffer)}sendWebAuthn(e){this.send(JSON.stringify(e))}pauseFlow(){}resumeFlow(){}requestResize(e,t){if(this.socket){f.info("requesting new screen size",`w:${e} and h:${t}`);var r=JSON.stringify({event:s.by.RESIZE,width:e,height:t,size:`${e}:${t}`}),n=this._proto.encodeResizeMessage(r),o=new Uint8Array(n);this.socket.send(o.buffer)}}_flushBuffer(){this.emit(s.y2.DATA,this._attachSocketBuffer),this._attachSocketBuffer=null,clearTimeout(this._attachSocketBufferTimer),this._attachSocketBufferTimer=null}_pushToBuffer(e){this._attachSocketBuffer?this._attachSocketBuffer+=e:(this._attachSocketBuffer=e,setTimeout(this._flushBuffer.bind(this),10))}_onOpenConnection(){this.emit("open"),f.info("websocket is open")}_onCloseConnection(e){this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket=null,this.emit(s.y2.CONN_CLOSE,e),f.info("websocket is closed")}_onMessage(e){try{const t=new Uint8Array(e.data),r=this._proto.decode(t);switch(r.type){case a.WEBAUTHN_CHALLENGE:this.emit(s.y2.WEBAUTHN_CHALLENGE,r.payload);break;case a.AUDIT:this._processAuditPayload(r.payload);break;case a.SESSION_END:this.emit(s.y2.CLOSE,r.payload);break;case a.RAW:this._buffered?this._pushToBuffer(r.payload):this.emit(s.y2.DATA,r.payload);break;default:throw Error(`unknown message type: ${r.type}`)}}catch(e){f.error("failed to parse incoming message.",e)}}_processAuditPayload(e){const t=JSON.parse(e);if(t.event===s.by.RESIZE){let[e,r]=t.size.split(":");e=Number(e),r=Number(r),this.emit(s.y2.RESIZE,{w:e,h:r})}}}const g=m},2070:(e,t,r)=>{r.d(t,{Z:()=>c});var n=r(2784),o=r(9175),s=r(9376);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){const[t,r]=(0,n.useState)({requested:!1,errorText:"",publicKey:null}),i=e=>{const n=JSON.parse(e),o=(0,s.ee)(n).webauthnPublicKey;r(a(a({},t),{},{requested:!0,publicKey:o}))};return(0,n.useEffect)((()=>{if(e)return e.on(o.y2.WEBAUTHN_CHALLENGE,i),()=>{e.removeListener(o.y2.WEBAUTHN_CHALLENGE,i)}}),[e]),{errorText:t.errorText,requested:t.requested,authenticate:function(){if(window.PublicKeyCredential)navigator.credentials.get({publicKey:t.publicKey}).then((n=>{const o=(0,s.oH)(n);e.sendWebAuthn(o),r(a(a({},t),{},{requested:!1,errorText:""}))})).catch((e=>{r(a(a({},t),{},{errorText:e.message}))}));else{const e="This browser does not support WebAuthn required for hardware tokens,       please try the latest version of Chrome, Firefox or Safari.";r(a(a({},t),{},{errorText:e}))}},setState:r}}}}]);