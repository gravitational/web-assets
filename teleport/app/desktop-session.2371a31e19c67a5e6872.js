"use strict";(self.webpackChunk_gravitational_teleport=self.webpackChunk_gravitational_teleport||[]).push([[456],{8201:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F});var r=n(2784),o=n(7849),i=n(9124),s=n(9161),a=n(2282),c=n(4523),l=n(4517),u=n(4696),p=n(2070),d=n(130),f=n(8230),h=n(3958),y=n(1727),m=n(1452),b=n(7278),g=n(3228),v=n(917),w=n(3757),E=n(7559),O=n(3937);function C(e){const{showShareDirectory:t,onShareDirectory:n,onDisconnect:i}=e;return r.createElement(o.kC,{alignItems:"center"},r.createElement(O.Oq,{buttonIconProps:{ml:4,size:0,color:"text.secondary",style:{fontSize:"20px"}},menuProps:S},t&&r.createElement(O.sN,{onClick:n},r.createElement(O.ZH,{as:w.GSs,mr:"2"}),"Share Directory (preview)"),r.createElement(O.sN,{onClick:i},r.createElement(O.ZH,{as:w.Lk_,mr:"2"}),"Disconnect")))}const S={menuListCss:()=>"\n  width: 250px;\n"};function D(e){const{userHost:t,clipboardSharingEnabled:n,onDisconnect:i,canShareDirectory:s,isSharingDirectory:a,onShareDirectory:c}=e,l=(0,v.Fg)(),u=e=>({color:e?l.colors.text.primary:l.colors.text.secondary});return r.createElement(o.tD,{height:`${x}px`,bg:E.O.dark,style:{justifyContent:"space-between"}},r.createElement(o.xv,{px:3,style:{color:l.colors.text.secondary}},t),r.createElement(o.kC,{px:3},r.createElement(o.kC,{alignItems:"center"},r.createElement(j,{style:u(a),pr:3,title:a?"Directory Sharing Enabled":"Directory Sharing Disabled"}),r.createElement(P,{style:u(n),pr:3,title:n?"Clipboard Sharing Enabled":"Clipboard Sharing Disabled"})),r.createElement(C,{onDisconnect:i,showShareDirectory:s&&!a,onShareDirectory:c})))}const x=40,P=(0,v.ZP)(w.TUt)(["font-weight:",";font-size:",";align-self:'center';"],(e=>{let{theme:t}=e;return t.fontWeights.bold}),(e=>{let{theme:t}=e;return t.fontSizes[4]+"px"})),j=(0,v.ZP)(w.ot9)(["font-weight:",";font-size:",";align-self:'center';"],(e=>{let{theme:t}=e;return t.fontWeights.bold}),(e=>{let{theme:t}=e;return t.fontSizes[6]+"px"}));function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(){return{width:window.innerWidth,height:window.innerHeight-x}}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){N(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(){return W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W.apply(this,arguments)}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e){const{directorySharingState:t,setDirectorySharingState:n,fetchAttempt:a,tdpConnection:c,disconnected:l,wsConnection:u,setTdpConnection:p,showAnotherSessionActiveDialog:d,setShowAnotherSessionActiveDialog:f}=e,h="processing"===a.status||"processing"===c.status,y=()=>{p((e=>""===e.status?{status:"success"}:e)),n((e=>I(I({},e),{},{browserError:!1})))},m=(()=>{const e="closed"===u&&!l&&("success"===c.status||""===c.status);let n="";return"failed"===a.status?n=a.statusText||"fetch attempt failed":"failed"===c.status?n=c.statusText||"tdp connection failed":""===c.status?n=c.statusText||"encountered a non-fatal error":e?n="Session disconnected for an unknown reason.":t.browserError?n='Your user role supports directory sharing over desktop access,       however this feature is only available by default on some Chromium       based browsers like Google Chrome or Microsoft Edge. Brave users can       use the feature by navigating to brave://flags/#file-system-access-api       and selecting "Enable". Please switch to a supported browser.':"processing"===a.status&&"success"===c.status&&(n="The application has detected an invalid internal application state.         Please file a bug report for this issue at         https://github.com/gravitational/teleport/issues/new?assignees=&labels=bug&template=bug_report.md"),{open:""!==n,text:n,fatal:!(""===c.status||t.browserError)}})();if(m.open){const t=!m.fatal;return r.createElement($,W({},e,{initTdpCli:t,displayCanvas:t}),r.createElement(s.ZP,{dialogCss:()=>({width:"484px"}),onClose:y,open:m.open},r.createElement(s.fK,{style:{flexDirection:"column"}},m.fatal&&r.createElement(s.$N,null,"Fatal Error"),!m.fatal&&r.createElement(s.$N,null,"Unsupported Action")),r.createElement(s.cZ,null,m.fatal&&r.createElement(r.Fragment,null,r.createElement(i.b0,{children:r.createElement(r.Fragment,null,m.text)}),"Refresh the page to try again."),!m.fatal&&r.createElement(i.v3,{my:2,children:m.text})),r.createElement(s.cN,null,!m.fatal&&r.createElement(o.PL,{size:"large",width:"30%",onClick:y},"Dismiss"),m.fatal&&r.createElement(o.PL,{size:"large",width:"30%",onClick:()=>{window.location.reload()}},"Refresh"))))}if(d){const t=!1;return r.createElement($,W({},e,{initTdpCli:t,displayCanvas:!1}),r.createElement(s.ZP,{dialogCss:()=>({width:"484px"}),onClose:()=>{},open:!0},r.createElement(s.fK,{style:{flexDirection:"column"}},r.createElement(s.$N,null,"Another Session Is Active")),r.createElement(s.cZ,null,"This desktop has an active session, connecting to it may close the other session. Do you wish to continue?"),r.createElement(s.cN,null,r.createElement(o.DF,{mr:3,onClick:()=>{window.close()}},"Abort"),r.createElement(o.PL,{onClick:()=>{f(!1)}},"Continue"))))}if(l)return r.createElement($,W({},e,{initTdpCli:!1,displayCanvas:!1}),r.createElement(o.xu,{textAlign:"center",m:10},r.createElement(o.xv,null,"Session successfully disconnected")));if(h){const t="processing"!==a.status;return r.createElement($,W({},e,{initTdpCli:t,displayCanvas:!1}),r.createElement(o.xu,{textAlign:"center",m:10},r.createElement(o.z$,null)))}return r.createElement($,W({},e,{initTdpCli:!0,displayCanvas:!0}))}function $(e){const{setDisconnected:t,webauthn:n,tdpClient:i,username:s,hostname:l,clipboardSharingEnabled:u,setClipboardSharingEnabled:p,directorySharingState:d,setDirectorySharingState:f,onPngFrame:h,onClipboardData:y,onTdpError:m,onWsClose:b,onWsOpen:g,onKeyDown:v,onKeyUp:w,onMouseMove:E,onMouseDown:O,onMouseUp:C,onMouseWheelScroll:S,onContextMenu:x,initTdpCli:P,displayCanvas:j}=e,L=u;return r.createElement(o.kC,{flexDirection:"column"},r.createElement(D,{onDisconnect:()=>{t(!0),p(!1),f((e=>I(I({},e),{},{isSharing:!1}))),i.nuke()},userHost:`${s}@${l}`,clipboardSharingEnabled:L,canShareDirectory:d.canShare,isSharingDirectory:d.isSharing,onShareDirectory:()=>{try{window.showDirectoryPicker().then((e=>{f((e=>I(I({},e),{},{isSharing:!0}))),i.addSharedDirectory(e),i.sendSharedDirectoryAnnounce()})).catch((()=>{f((e=>I(I({},e),{},{isSharing:!1})))}))}catch(e){f((e=>I(I({},e),{},{browserError:!0})))}}}),e.children,n.requested&&r.createElement(c.Z,{onContinue:n.authenticate,onCancel:()=>{n.setState((e=>I(I({},e),{},{errorText:'This session requires multi factor authentication to continue. Please hit "Retry" and follow the prompts given by your browser to complete authentication.'})))},errorText:n.errorText}),r.createElement(a.Z,{style:{display:j?"flex":"none",flex:1},tdpCli:i,tdpCliInit:P,tdpCliOnPngFrame:h,tdpCliOnClipboardData:y,tdpCliOnTdpError:m,tdpCliOnWsClose:b,tdpCliOnWsOpen:g,onKeyDown:v,onKeyUp:w,onMouseMove:E,onMouseDown:O,onMouseUp:C,onMouseWheelScroll:S,onContextMenu:x}))}const F=function(){const e=function(){const{attempt:e,run:t}=(0,u.Z)("processing"),{attempt:n,setAttempt:o}=(0,u.Z)("processing"),[i,s]=(0,r.useState)("closed"),[a,c]=(0,r.useState)(!1),[v,w]=(0,r.useState)({canShare:!1,isSharing:!1,browserError:!1}),{username:E,desktopName:O,clusterId:C}=(0,l.UO)(),[S,D]=(0,r.useState)(""),x=navigator.userAgent.includes("Chrome"),[P,j]=(0,r.useState)(!1),[L,A]=(0,r.useState)(!1);document.title=(0,r.useMemo)((()=>`${C} â€¢ ${E}@${S}`),[S]),(0,r.useEffect)((()=>{t((()=>Promise.all([d.Z.fetchDesktop(C,O).then((e=>D(e.name))),f.ZP.fetchUserContext().then((e=>{j(e.acl.clipboardSharingEnabled&&x),w((t=>M(M({},t),{},{canShare:e.acl.directorySharingEnabled})))})),d.Z.checkDesktopIsActive(C,O).then((e=>{A(e)}))])))}),[C,O]);const _=function(e){const{username:t,desktopName:n,clusterId:o,setTdpConnection:i,setWsConnection:s,setClipboardSharingEnabled:a,setDirectorySharingState:c,clipboardSharingEnabled:l}=e,[u,p]=(0,r.useState)(null),d=(0,r.useRef)(!1),f=(0,r.useRef)(new TextEncoder),v=(0,r.useRef)("");(0,r.useEffect)((()=>{const{width:e,height:r}=k(),i=b.Z.api.desktopWsAddr.replace(":fqdn",(0,m.Lp)()).replace(":clusterId",o).replace(":desktopName",n).replace(":token",(0,m.hP)()).replace(":username",t).replace(":width",e.toString()).replace(":height",r.toString());p(new y.pe(i))}),[o,t,n]);const{isMac:w}=(0,h.Z)(),E=(e,t)=>!("CapsLock"!==t.code||!w||(e.sendKeyboardInput(t.code,y.BN.DOWN),e.sendKeyboardInput(t.code,y.BN.UP),0)),O=e=>{l&&document.hasFocus()&&navigator.clipboard.readText().then((t=>{(0,g.Kp)(t,f.current).then((n=>{t&&n!==v.current&&(e.sendClipboardData({data:t}),v.current=n)}))}))};return{tdpClient:u,onPngFrame:(e,t)=>{d.current||((e=>{const{width:t,height:n}=k();e.width=t,e.height=n})(e.canvas),i({status:"success"}),d.current=!0),e.drawImage(t.data,t.left,t.top)},onTdpError:e=>{const{err:t,isFatal:n}=e;c((e=>T(T({},e),{},{isSharing:!1}))),a(!1),i({status:n?"failed":"",statusText:t.message})},onClipboardData:async e=>{if(l&&document.hasFocus()&&e.data){navigator.clipboard.writeText(e.data);let t=await(0,g.Kp)(e.data,f.current);v.current=t}},onWsClose:()=>{s("closed")},onWsOpen:()=>{s("open")},onKeyDown:(e,t)=>{t.preventDefault(),E(e,t)||(e.sendKeyboardInput(t.code,y.BN.DOWN),"MetaRight"!==t.code&&"MetaLeft"!==t.code&&"AltRight"!==t.code&&"AltLeft"!==t.code&&O(e))},onKeyUp:(e,t)=>{t.preventDefault(),E(e,t)||e.sendKeyboardInput(t.code,y.BN.UP)},onMouseMove:(e,t,n)=>{const r=t.getBoundingClientRect(),o=n.clientX-r.left,i=n.clientY-r.top;e.sendMouseMove(o,i)},onMouseDown:(e,t)=>{0!==t.button&&1!==t.button&&2!==t.button||e.sendMouseButton(t.button,y.BN.DOWN),O(e)},onMouseUp:(e,t)=>{0!==t.button&&1!==t.button&&2!==t.button||e.sendMouseButton(t.button,y.BN.UP)},onMouseWheelScroll:(e,t)=>{t.preventDefault(),t.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(t.deltaX&&e.sendMouseWheelScroll(y.Yc.HORIZONTAL,-t.deltaX),t.deltaY&&e.sendMouseWheelScroll(y.Yc.VERTICAL,-t.deltaY))},onContextMenu:()=>!1}}({username:E,desktopName:O,clusterId:C,setTdpConnection:o,setWsConnection:s,setClipboardSharingEnabled:j,setDirectorySharingState:w,clipboardSharingEnabled:P}),N=(0,p.Z)(_.tdpClient);return M({hostname:S,username:E,clipboardSharingEnabled:P,setClipboardSharingEnabled:j,directorySharingState:v,setDirectorySharingState:w,isUsingChrome:x,fetchAttempt:e,tdpConnection:n,wsConnection:i,disconnected:a,setDisconnected:c,webauthn:N,setTdpConnection:o,showAnotherSessionActiveDialog:L,setShowAnotherSessionActiveDialog:A},_)}();return r.createElement(Z,e)}},4523:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(2784),o=n(9161),i=n(9124),s=n(7849);const a=function(e){let{onContinue:t,onCancel:n,errorText:a}=e;return r.createElement(o.ZP,{dialogCss:()=>({width:"400px"}),open:!0},r.createElement(o.fK,{style:{flexDirection:"column"}},r.createElement(o.$N,{textAlign:"center"},"Verify Your Identity")),r.createElement(o.cZ,{mb:6},a&&r.createElement(i.b0,{mt:2,width:"100%"},a),r.createElement(s.xv,{textAlign:"center"},"Re-authentication is required. Follow the prompts given by your browser to complete authentication.")),r.createElement(o.cN,{textAlign:"center"},r.createElement(s.DF,{onClick:t,mr:3,width:"130px"},a?"Retry":"Verify"),r.createElement(s.PL,{onClick:n},"Cancel")))}},2070:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(2784),o=n(9175),i=n(9376);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){const[t,n]=(0,r.useState)({requested:!1,errorText:"",publicKey:null}),s=e=>{const r=JSON.parse(e),o=(0,i.ee)(r).webauthnPublicKey;n(a(a({},t),{},{requested:!0,publicKey:o}))};return(0,r.useEffect)((()=>{if(e)return e.on(o.y2.WEBAUTHN_CHALLENGE,s),()=>{e.removeListener(o.y2.WEBAUTHN_CHALLENGE,s)}}),[e]),{errorText:t.errorText,requested:t.requested,authenticate:function(){if(window.PublicKeyCredential)navigator.credentials.get({publicKey:t.publicKey}).then((r=>{const o=(0,i.oH)(r);e.sendWebAuthn(o),n(a(a({},t),{},{requested:!1,errorText:""}))})).catch((e=>{n(a(a({},t),{},{errorText:e.message}))}));else{const e="This browser does not support WebAuthn required for hardware tokens,       please try the latest version of Chrome, Firefox or Safari.";n(a(a({},t),{},{errorText:e}))}},setState:n}}},3228:(e,t,n)=>{n.d(t,{ES:()=>s,Kp:()=>o,RB:()=>r,Sl:()=>i});const r=e=>{const t=document.createElement("a");t.setAttribute("href",`${e}`),t.setAttribute("target","_blank"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)};async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new TextEncoder;const n=t.encode(e),r=await crypto.subtle.digest("SHA-256",n),o=Array.from(new Uint8Array(r)),i=o.map((e=>e.toString(16).padStart(2,"0"))).join("");return i}function i(e){let{authType:t,clusterId:n,username:r,accessRequestId:o}=e;const{hostname:i,port:s}=window.location;return`tsh login --proxy=${i}:${s||"443"} ${"local"===t?`--auth=${t} --user=${r} `:""}${n}${o?` --request-id=${o}`:""}`}function s(e,t){return e.filter((e=>!t.includes(e)))}},2699:e=>{var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}y(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var o,i,s,l;if(a(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=c(e))>0&&s.length>o&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,l=u,console&&console.warn&&console.warn(l)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=u.bind(r);return o.listener=n,r.wrapFn=o,o}function d(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):h(o,o.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){r.once&&e.removeEventListener(t,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var l=c.length,u=h(c,l);for(n=0;n<l;++n)r(u[n],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,p(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,p(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,o,i,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},i.prototype.listenerCount=f,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}}]);