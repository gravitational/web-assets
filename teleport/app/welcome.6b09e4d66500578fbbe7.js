"use strict";(self.webpackChunk_gravitational_teleport=self.webpackChunk_gravitational_teleport||[]).push([[773],{8509:(e,t,r)=>{r.r(t),r.d(t,{default:()=>K});var n=r(2784),o=r(7885),a=r(1392),l=r(4116),s=r(7278),c=r(1218),i=r(5081),u=r(917),d=r(5070),p=r(3388),m=r(2376);const h=(0,u.ZP)(c.xu)([".print-only{visibility:hidden;}@media print{overflow:hidden;.print,.print-only{visibility:visible;}.no-print{visibility:hidden;}.codes{font-size:16px;}}"]),v=(0,u.ZP)(c.DF)(["max-width:48px;width:100%;padding:4px 8px;min-height:10px;font-size:10px;"]),y=function(e){let{recoveryCodes:t,onContinue:r,isNewCodes:o,continueText:a="Continue",username:l=""}=e;const s=(0,n.useRef)(),i=e=>{l&&m.y.capturePreUserEvent({event:e,username:l})};let u="Backup & Recovery Codes",y=`I have saved my Recovery Codes - ${a}`;return o&&(u="New Backup & Recovery Codes",y=`I have saved my new Recovery Codes - ${a}`),n.createElement(h,null,n.createElement(c.Zb,{as:c.kC,flexWrap:"wrap",mx:"auto",minWidth:"584px",maxWidth:"1024px",borderRadius:8,overflow:"hidden",className:"no-print"},n.createElement(c.kC,{flex:4,bg:"primary.light",minWidth:"584px",flexDirection:"column",p:5,className:"print"},n.createElement(c.xu,{mb:5},n.createElement(c.xv,{typography:"h2",mb:3,color:"light"},u),n.createElement(c.xv,{mb:1},"Please save these account recovery codes in a safe offline place."),n.createElement(c.xv,null,"You can use each code once if you lose your second factor authenticator or password.")),n.createElement(c.xu,null,n.createElement(c.xv,{bold:!0,mb:2,caps:!0},"Recovery Codes (",null==t?void 0:t.codes.length," Total)"),n.createElement(c.kC,{bg:"primary.dark",p:2,pb:4,pl:3,borderRadius:8,justifyContent:"space-between"},n.createElement(c.xv,{style:{whiteSpace:"pre-wrap"},mt:2,ref:s,className:"codes"},null==t?void 0:t.codes.join("\n\n")),n.createElement(c.kC,{flexDirection:"column",className:"no-print",ml:2},n.createElement(v,{onClick:()=>{(0,d.Z)(`${null==t?void 0:t.codes.join("\n")} \n\nCreated: ${null==t?void 0:t.createdDate}`).then((()=>{(0,p.Z)(s.current)})),i(m.z.PreUserRecoveryCodesCopyClickEvent)}},"COPY"),n.createElement(v,{onClick:()=>{window.print(),i(m.z.PreUserRecoveryCodesPrintClickEvent)},mt:2},"PRINT"))),n.createElement(c.xv,{className:"print-only"},`Created: ${null==t?void 0:t.createdDate.toString()}`),n.createElement(c.DF,{mt:6,size:"large",width:"100%",className:"no-print",onClick:()=>{i(m.z.PreUserRecoveryCodesContinueClickEvent),r()}},y))),n.createElement(c.kC,{flex:2,bg:"primary.main",minWidth:"384px",flexDirection:"column",p:5},n.createElement(c.xu,{mb:4},n.createElement(c.xv,{typography:"h4",mb:2},"Why do I need these codes?"),n.createElement(c.xv,{color:"text.secondary"},"Use them in the event of losing your password or two-factor device.")),n.createElement(c.xu,{mb:4},n.createElement(c.xv,{typography:"h4",mb:2},"How long do the codes last for?"),n.createElement(c.xv,{color:"text.secondary"},"Recovery codes can only be used once. After recovering your account, we will generate a new set of codes for you.")),o&&n.createElement(c.xu,null,n.createElement(c.xv,{typography:"h4",mb:2},"What about my old codes?"),n.createElement(c.xv,{color:"text.secondary"},"Your old recovery codes are no longer valid, please replace them with these new ones.")))))};var b=r(2966),f=r(4696),g=r(9376);function E(e){let{resetMode:t=!1}=e;const r=t?"Reset":"Invitation",o=t?"reset":"invite";return n.createElement(c.Zb,{width:"540px",color:"text.onLight",p:6,bg:"light",mt:6,mx:"auto"},n.createElement(c.xv,{typography:"h1",textAlign:"center",fontSize:8,color:"text",mb:3},r," Code Expired"),n.createElement(c.xv,{typography:"paragraph",mb:"2"},"It appears that your ",o," code isn't valid any more. Please contact your account administrator and request another ",o," ","link."),n.createElement(c.xv,{typography:"paragraph"},"If you believe this is an issue with the product, please create a",n.createElement(x,null," GitHub issue"),"."))}const x=u.ZP.a.attrs({href:"https://github.com/gravitational/teleport/issues/new"})(["color:",";&:visted{color:",";}"],(e=>e.theme.colors.link),(e=>e.theme.colors.link)),w=r.p+"assets/img/img-3fc1dd.png";function C(e){let{redirect:t,resetMode:r=!1,username:o=""}=e;const a=r?"reset":"registration";return n.createElement(c.Zb,{width:"540px",p:6,bg:"primary.light",mt:6,mx:"auto",textAlign:"center"},n.createElement(c.xv,{typography:"h3",color:"text",mb:3,style:{textTransform:"capitalize"}},a," successful"),n.createElement(c.kC,{justifyContent:"center",mb:3},n.createElement(c.Ee,{src:w,width:"200px",height:"143px"})),n.createElement(c.xv,{fontSize:2,color:"text.secondary",mb:4},"Congratulations your ",a," is completed.",n.createElement("br",null),"Proceed to access your account."),n.createElement(c.DF,{width:"100%",size:"large",onClick:()=>{o&&m.y.capturePreUserEvent({event:m.z.PreUserCompleteGoToDashboardClickEvent,username:o}),t()}},"Go to Dashboard"))}var k=r(9124),P=r(3757);const S=["options","value","onChange","autoFocus","name"];function Z(){return Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Z.apply(this,arguments)}function A(e){let{options:t,value:r,onChange:o,autoFocus:a,name:l}=e,s=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,S);return n.createElement(c.kC,Z({flexDirection:"column"},s),t.map(((e,t)=>{const s=T(e)?e.value:e;return n.createElement(O,{onChange:o,autoFocus:0===t&&a,key:s,option:e,name:l,checked:void 0!==r?r===s:void 0})})))}function O(e){const t=T(e.option)?e.option.value:e.option,r=T(e.option)?e.option.label:e.option;return n.createElement(D,null,n.createElement(R,{autoFocus:e.autoFocus,type:"radio",name:e.name,checked:e.checked,onChange:()=>{var r;return null===(r=e.onChange)||void 0===r?void 0:r.call(e,t)},value:t}),n.createElement("span",null,r))}function T(e){return"object"==typeof e}var D=(0,u.ZP)("label")(["display:flex;align-items:center;cursor:pointer;"]),R=(0,u.ZP)("input")(["margin:0 ","px 0 0;accent-color:",";cursor:inherit;"],(e=>e.theme.space[2]),(e=>e.theme.colors.accent)),F=r(6933),U=r(8197),j=r(7097),z=r(9750),W=r(9127);const I=r.p+"assets/img/img-aae28f.png";function N(e){return"webauthn"===e?"webauthn-device":"otp"===e?"otp-device":""}var M=(0,u.ZP)(c.Ee)(["border:4px solid white;"]);function G(){return G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},G.apply(this,arguments)}const $={local:[function(e){const{submitAttempt:t,resetToken:r,isPasswordlessEnabled:o,onSubmit:a,auth2faType:l,primaryAuthType:s,password:i,updatePassword:u,changeFlow:d,next:p,refCallback:m,hasTransitionEnded:h}=e,[v,y]=(0,n.useState)(""),b="off"!==l,f=(0,W.U7)({shouldFocus:h});function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.preventDefault(),d({flow:"passwordless",applyNextAnimation:t})}return n.createElement(U.ZP,null,(e=>{let{validator:l}=e;return n.createElement(c.xu,{p:5,ref:m,"data-testid":"password"},b&&n.createElement(c.xv,{color:"text.secondary"},"Step 1 of 2"),n.createElement(c.xv,{typography:"h4",bold:!0,mb:3,color:"light"},"Set A Password"),"failed"===t.status&&n.createElement(k.b0,{children:t.statusText}),n.createElement(F.Z,{label:"Username",value:r.user,onChange:()=>null,readonly:!0}),n.createElement(F.Z,{rule:j.qQ,ref:f,autoComplete:"off",label:"Password",value:i,onChange:e=>u(e.target.value),type:"password",placeholder:"Password"}),n.createElement(F.Z,{rule:(0,j.el)(i),autoComplete:"off",label:"Confirm Password",value:v,onChange:e=>y(e.target.value),type:"password",placeholder:"Confirm Password"}),n.createElement(c.DF,{width:"100%",mt:3,size:"large",onClick:e=>function(e,t){e.preventDefault(),t.validate()&&(b?p():a(i))}(e,l),disabled:"processing"===t.status},b?"Next":"Submit"),"passwordless"!==s&&o&&n.createElement(c.xu,{mt:3,textAlign:"center"},n.createElement(c.oD,{onClick:e=>g(e),disabled:"processing"===t.status},"Go Passwordless")),"passwordless"===s&&n.createElement(c.xu,{mt:3,textAlign:"center"},n.createElement(c.oD,{onClick:e=>g(e,!0),disabled:"processing"===t.status},"Back")))}))},function(e){const{resetToken:t,submitAttempt:r,clearSubmitAttempt:o,auth2faType:a,onSubmitWithWebauthn:l,onSubmit:s,password:i,prev:u,refCallback:d,hasTransitionEnded:p,currFlow:h}=e,[v,y]=(0,n.useState)(""),b=(0,z.Z)({auth2faType:a}),[f,g]=(0,n.useState)(b[0]),[E,x]=(0,n.useState)((()=>N(f.value))),w=(0,W.U7)({shouldFocus:p,refocusDeps:[f.value]}),C="otp"===(null==f?void 0:f.value)?`data:image/png;base64,${t.qrCode}`:I;return n.createElement(U.ZP,null,(e=>{let{validator:a}=e;return n.createElement(c.xu,{p:5,ref:d},n.createElement(c.kC,{mb:3,alignItems:"center"},n.createElement(P.xhZ,{fontSize:30,mr:3,onClick:()=>{o(),u()},style:{cursor:"pointer"}}),n.createElement(c.xu,null,n.createElement(c.xv,{color:"text.secondary"},"Step 2 of 2"),n.createElement(c.xv,{typography:"h4",color:"light",bold:!0},"Set Two-Factor Device"))),"failed"===r.status&&n.createElement(k.b0,{children:r.statusText}),n.createElement(c.xv,{typography:"subtitle1",color:"light",caps:!0,mb:1},"Two-Factor Method"),n.createElement(c.xu,{mb:1},n.createElement(A,{name:"mfaType",options:b,value:f.value,flexDirection:"row",gap:"16px",onChange:e=>function(e,t){y(""),o(),t.reset();const r=b.find((t=>t.value===e));r&&(g(r),x(N(r.value)))}(e,a)})),n.createElement(c.kC,{flexDirection:"column",justifyContent:"center",alignItems:"center",borderRadius:8,bg:"optional"===(null==f?void 0:f.value)?"primary.lighter":"",height:"optional"===(null==f?void 0:f.value)?"340px":"240px",px:3},"otp"===(null==f?void 0:f.value)&&n.createElement(n.Fragment,null,n.createElement(M,{src:C,width:"145px",height:"145px"}),n.createElement(c.xv,{fontSize:1,textAlign:"center",mt:2,color:"text.secondary"},"Scan the QR Code with any authenticator app and enter the generated code. We recommend"," ",n.createElement(c.rU,{href:"https://authy.com/download/",target:"_blank"},"Authy"),".")),"webauthn"===(null==f?void 0:f.value)&&n.createElement(n.Fragment,null,n.createElement(c.Ee,{src:C,width:"220px",height:"154px"}),n.createElement(c.xv,{fontSize:1,color:"text.secondary",textAlign:"center"},"We support a wide range of hardware devices including YubiKeys, Touch ID, watches, and more.")),"optional"===(null==f?void 0:f.value)&&n.createElement(c.xv,{textAlign:"center"},"We strongly recommend enrolling a two-factor device to protect both yourself and your organization.")),"optional"!==(null==f?void 0:f.value)&&n.createElement(c.kC,{alignItems:"center",height:100},n.createElement(F.Z,{rule:(0,j.lp)("Device name is required"),label:"Device name",placeholder:"Name",ref:w,width:"otp"===(null==f?void 0:f.value)?"50%":"100%",value:E,type:"text",onChange:e=>x(e.target.value),readonly:"processing"===r.status,mr:"otp"===(null==f?void 0:f.value)?3:0}),"otp"===(null==f?void 0:f.value)&&n.createElement(F.Z,{width:"50%",label:"Authenticator code",rule:j.Sb,inputMode:"numeric",autoComplete:"one-time-code",value:v,onChange:e=>y(e.target.value),placeholder:"123 456",readonly:"processing"===r.status})),n.createElement(c.DF,{width:"100%",mt:2,disabled:"processing"===r.status,size:"large",onClick:e=>function(e,r){e.preventDefault(),m.y.capturePreUserEvent({event:m.z.PreUserOnboardRegisterChallengeSubmitEvent,username:t.user,mfaType:f.value,loginFlow:h}),r.validate()&&("webauthn"===(null==f?void 0:f.value)?l(i,E):s(i,v,E))}(e,a)},"Submit"))}))}],passwordless:[function(e){var t,r;const{submitAttempt:o,onSubmitWithWebauthn:a,primaryAuthType:l,isPasswordlessEnabled:s,changeFlow:i,refCallback:u,hasTransitionEnded:d,clearSubmitAttempt:p}=e,[m,h]=(0,n.useState)("passwordless-device"),v=(0,W.U7)({shouldFocus:d});function y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.preventDefault(),p(),i({flow:"local",applyNextAnimation:t})}const b=null===(t=window.navigator)||void 0===t||null===(r=t.userAgent)||void 0===r?void 0:r.toLowerCase().includes("firefox");return n.createElement(U.ZP,null,(e=>{let{validator:t}=e;return n.createElement(c.xu,{px:5,pb:4,pt:5,ref:u,"data-testid":"passwordless"},n.createElement(c.xv,{typography:"h4",mb:3,color:"light",bold:!0},"Set A Passwordless Device"),"failed"===o.status&&n.createElement(k.b0,{children:o.statusText}),b&&n.createElement(k.kI,{mt:3},"Firefox may not support passwordless register. Please try Chrome or Safari."),n.createElement(F.Z,{rule:(0,j.lp)("Device name is required"),label:"Device name",placeholder:"Name",width:"100%",ref:v,value:m,type:"text",onChange:e=>h(e.target.value),readonly:"processing"===o.status}),n.createElement(c.DF,{width:"100%",mt:1,size:"large",onClick:e=>function(e,t){e.preventDefault(),t.validate()&&a("",m)}(e,t),disabled:"processing"===o.status},"Submit"),"passwordless"!==l&&s&&n.createElement(c.xu,{mt:3,textAlign:"center"},n.createElement(c.oD,{onClick:e=>y(e,!0),disabled:"processing"===o.status},"Back")),"passwordless"===l&&n.createElement(c.xu,{mt:3,textAlign:"center"},n.createElement(c.oD,{onClick:e=>y(e),disabled:"processing"===o.status},"Use password")))}))}]};function q(e){let{tokenId:t="",resetMode:r=!1}=e;const o=function(e){const[t,r]=(0,n.useState)(),[o,l]=(0,n.useState)(),[c,i]=(0,n.useState)(!1),[u,d]=(0,n.useState)(!1),p=(0,f.Z)(""),h=(0,f.Z)(""),v=s.Z.getAuth2faType();function y(e){m.y.capturePreUserEvent({event:m.z.PreUserOnboardSetCredentialSubmitEvent,username:t.user}),e.privateKeyPolicyEnabled&&d(!0),e.recovery.createdDate?l(e.recovery):b()}function b(){i(!0)}return(0,n.useEffect)((()=>{p.run((()=>g.ZP.fetchPasswordToken(e).then((e=>r(e)))))}),[]),{auth2faType:v,primaryAuthType:s.Z.getPrimaryAuthType(),isPasswordlessEnabled:s.Z.isPasswordlessEnabled(),fetchAttempt:p.attempt,submitAttempt:h.attempt,clearSubmitAttempt:function(){h.setAttempt({status:""})},onSubmit:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";h.setAttempt({status:"processing"}),g.ZP.resetPassword({tokenId:e,password:t,otpCode:r,deviceName:n}).then(y).catch(h.handleError)},onSubmitWithWebauthn:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";h.setAttempt({status:"processing"}),g.ZP.resetPasswordWithWebauthn({tokenId:e,password:t,deviceName:r}).then(y).catch(h.handleError)},resetToken:t,recoveryCodes:o,redirect:function(){a.Z.push(s.Z.routes.root,!0)},success:c,finishedRegister:b,privateKeyPolicyEnabled:u}}(t);return n.createElement(B,G({},o,{resetMode:r}))}function B(e){const{fetchAttempt:t,recoveryCodes:r,resetMode:o,resetToken:a,redirect:l,primaryAuthType:s,success:u,finishedRegister:d,privateKeyPolicyEnabled:p}=e;if("failed"===t.status)return n.createElement(E,{resetMode:o});if("success"!==t.status)return null;if(u&&p)return n.createElement(b.n,{title:o?"Reset Complete":"Registration Complete"});if(u)return n.createElement(C,{redirect:l,resetMode:o,username:a.user});if(r)return n.createElement(y,{recoveryCodes:r,onContinue:d,isNewCodes:o,username:a.user});const[m,h]=(0,n.useState)(""),[v,f]=(0,n.useState)(),[g,x]=(0,n.useState)((()=>"sso"===s||"local"===s?"local":"passwordless"));return n.createElement(c.Zb,{as:"form",bg:"primary.light",my:5,mx:"auto",width:464},n.createElement(i.z,G({flows:$,currFlow:g,onSwitchFlow:function(e){x(e)},newFlow:v,changeFlow:function(e){f(e)}},e,{password:m,updatePassword:function(e){h(e)}})))}function _(e){let{title:t,subTitle:r,btnText:o,onClick:a}=e;return n.createElement(c.Zb,{bg:"primary.light",my:6,mx:"auto",width:"464px"},n.createElement(c.xu,{p:6},n.createElement(c.xv,{typography:"h2",mb:3,textAlign:"center",color:"light"},t),n.createElement(c.xv,{typography:"h5",mb:3,textAlign:"center"},r),n.createElement(c.DF,{width:"100%",mt:3,size:"large",onClick:a},o)))}const K=function(){const{tokenId:e}=(0,o.UO)();return n.createElement(n.Fragment,null,n.createElement(l.Z,null),n.createElement(o.rs,null,n.createElement(o.AW,{exact:!0,path:s.Z.routes.userInvite},n.createElement(_,{title:"Welcome to Teleport",subTitle:"Please click the button below to create an account",btnText:"Get started",onClick:()=>{a.Z.push(s.Z.getUserInviteTokenContinueRoute(e))}})),n.createElement(o.AW,{exact:!0,path:s.Z.routes.userReset},n.createElement(_,{title:"Reset Authentication",subTitle:"Please click the button below to begin recovery of your account",btnText:"Continue",onClick:()=>{a.Z.push(s.Z.getUserResetTokenContinueRoute(e))}})),n.createElement(o.AW,{path:s.Z.routes.userInviteContinue},n.createElement(q,{tokenId:e})),n.createElement(o.AW,{path:s.Z.routes.userResetContinue},n.createElement(q,{resetMode:!0,tokenId:e}))))}},2376:(e,t,r)=>{r.d(t,{z:()=>i.z,y:()=>c});var n=r(1452),o=r(7278);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c={captureUserEvent(e){n.ZP.fetch(o.Z.api.captureUserEventPath,{method:"POST",body:JSON.stringify(e)})},capturePreUserEvent(e){n.ZP.fetch(o.Z.api.capturePreUserEventPath,{method:"POST",body:JSON.stringify(l({},e))})}};var i=r(2412)},2412:(e,t,r)=>{var n;r.d(t,{z:()=>n}),function(e){e.BannerClickEvent="tp.ui.banner.click",e.OnboardAddFirstResourceClickEvent="tp.ui.onboard.addFirstResource.click",e.OnboardAddFirstResourceLaterClickEvent="tp.ui.onboard.addFirstResourceLater.click",e.PreUserOnboardSetCredentialSubmitEvent="tp.ui.onboard.setCredential.submit",e.PreUserOnboardRegisterChallengeSubmitEvent="tp.ui.onboard.registerChallenge.submit",e.PreUserCompleteGoToDashboardClickEvent="tp.ui.onboard.completeGoToDashboard.click",e.PreUserRecoveryCodesContinueClickEvent="tp.ui.recoveryCodesContinue.click",e.PreUserRecoveryCodesCopyClickEvent="tp.ui.recoveryCodesCopy.click",e.PreUserRecoveryCodesPrintClickEvent="tp.ui.recoveryCodesPrint.click"}(n||(n={}))}}]);