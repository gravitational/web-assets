"use strict";(self.webpackChunk_gravitational_teleport=self.webpackChunk_gravitational_teleport||[]).push([[773],{2674:(e,t,r)=>{r.r(t),r.d(t,{default:()=>M});var n=r(2784),a=r(7885),o=r(1392),l=r(4116),s=r(7278),i=r(1218),c=r(5081),u=r(917),d=r(5070),m=r(3388),p=r(2376);const h=(0,u.ZP)(i.xu)([".print-only{visibility:hidden;}@media print{overflow:hidden;.print,.print-only{visibility:visible;}.no-print{visibility:hidden;}.codes{font-size:16px;}}"]),v=(0,u.ZP)(i.DF)(["max-width:48px;width:100%;padding:4px 8px;min-height:10px;font-size:10px;"]),b=function(e){let{recoveryCodes:t,onContinue:r,isNewCodes:a,continueText:o="Continue",username:l=""}=e;const s=(0,n.useRef)();let c="Backup & Recovery Codes",u=`I have saved my Recovery Codes - ${o}`;return a&&(c="New Backup & Recovery Codes",u=`I have saved my new Recovery Codes - ${o}`),n.createElement(h,null,n.createElement(i.Zb,{as:i.kC,flexWrap:"wrap",mx:"auto",minWidth:"584px",maxWidth:"1024px",borderRadius:8,overflow:"hidden",className:"no-print"},n.createElement(i.kC,{flex:4,bg:"primary.light",minWidth:"584px",flexDirection:"column",p:5,className:"print"},n.createElement(i.xu,{mb:5},n.createElement(i.xv,{typography:"h2",mb:3,color:"light"},c),n.createElement(i.xv,{mb:1},"Please save these account recovery codes in a safe offline place."),n.createElement(i.xv,null,"You can use each code once if you lose your second factor authenticator or password.")),n.createElement(i.xu,null,n.createElement(i.xv,{bold:!0,mb:2,caps:!0},"Recovery Codes (",null==t?void 0:t.codes.length," Total)"),n.createElement(i.kC,{bg:"primary.dark",p:2,pb:4,pl:3,borderRadius:8,justifyContent:"space-between"},n.createElement(i.xv,{style:{whiteSpace:"pre-wrap"},mt:2,ref:s,className:"codes"},null==t?void 0:t.codes.join("\n\n")),n.createElement(i.kC,{flexDirection:"column",className:"no-print",ml:2},n.createElement(v,{onClick:()=>{(0,d.Z)(`${null==t?void 0:t.codes.join("\n")} \n\nCreated: ${null==t?void 0:t.createdDate}`).then((()=>{(0,m.Z)(s.current)}))}},"COPY"),n.createElement(v,{onClick:window.print,mt:2},"PRINT"))),n.createElement(i.xv,{className:"print-only"},`Created: ${null==t?void 0:t.createdDate.toString()}`),n.createElement(i.DF,{mt:6,size:"large",width:"100%",className:"no-print",onClick:()=>{l&&p.y.capturePreUserEvent({event:p.z.PreUserRecoveryCodesContinueClickEvent,username:l}),r()}},u))),n.createElement(i.kC,{flex:2,bg:"primary.main",minWidth:"384px",flexDirection:"column",p:5},n.createElement(i.xu,{mb:4},n.createElement(i.xv,{typography:"h4",mb:2},"Why do I need these codes?"),n.createElement(i.xv,{color:"text.secondary"},"Use them in the event of losing your password or two-factor device.")),n.createElement(i.xu,{mb:4},n.createElement(i.xv,{typography:"h4",mb:2},"How long do the codes last for?"),n.createElement(i.xv,{color:"text.secondary"},"Recovery codes can only be used once. After recovering your account, we will generate a new set of codes for you.")),a&&n.createElement(i.xu,null,n.createElement(i.xv,{typography:"h4",mb:2},"What about my old codes?"),n.createElement(i.xv,{color:"text.secondary"},"Your old recovery codes are no longer valid, please replace them with these new ones.")))))};var g=r(2966),y=r(4696),f=r(9376);function E(e){let{resetMode:t=!1}=e;const r=t?"Reset":"Invitation",a=t?"reset":"invite";return n.createElement(i.Zb,{width:"540px",color:"text.onLight",p:6,bg:"light",mt:6,mx:"auto"},n.createElement(i.xv,{typography:"h1",textAlign:"center",fontSize:8,color:"text",mb:3},r," Code Expired"),n.createElement(i.xv,{typography:"paragraph",mb:"2"},"It appears that your ",a," code isn't valid any more. Please contact your account administrator and request another ",a," ","link."),n.createElement(i.xv,{typography:"paragraph"},"If you believe this is an issue with the product, please create a",n.createElement(x,null," GitHub issue"),"."))}const x=u.ZP.a.attrs({href:"https://github.com/gravitational/teleport/issues/new"})(["color:",";&:visted{color:",";}"],(e=>e.theme.colors.link),(e=>e.theme.colors.link)),w=r.p+"assets/img/img-3fc1dd.png";function C(e){let{redirect:t,resetMode:r=!1}=e;const a=r?"reset":"registration";return n.createElement(i.Zb,{width:"540px",p:6,bg:"primary.light",mt:6,mx:"auto",textAlign:"center"},n.createElement(i.xv,{typography:"h3",color:"text",mb:3,style:{textTransform:"capitalize"}},a," successful"),n.createElement(i.kC,{justifyContent:"center",mb:3},n.createElement(i.Ee,{src:w,width:"200px",height:"143px"})),n.createElement(i.xv,{fontSize:2,color:"text.secondary",mb:4},"Congratulations your ",a," is completed.",n.createElement("br",null),"Proceed to access your account."),n.createElement(i.DF,{width:"100%",size:"large",onClick:t},"Go to Dashboard"))}var k=r(9124),P=r(3757),S=r(6933),Z=r(8197),A=r(7097),T=r(9750),D=r(9127);const O=r.p+"assets/img/img-aae28f.png";function R(e){return"webauthn"===e?"webauthn-device":"otp"===e?"otp-device":""}const F=u.ZP.div(["display:inline-block;margin-right:16px;cursor:pointer;input{cursor:pointer;vertical-align:middle;margin:0 8px 0px 0;}label{cursor:pointer;vertical-align:middle;}"]);var U=(0,u.ZP)(i.Ee)(["border:4px solid white;"]);function W(){return W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W.apply(this,arguments)}const z={local:[function(e){const{submitAttempt:t,resetToken:r,isPasswordlessEnabled:a,onSubmit:o,auth2faType:l,primaryAuthType:s,password:c,updatePassword:u,changeFlow:d,next:m,refCallback:h,hasTransitionEnded:v}=e,[b,g]=(0,n.useState)(""),y="off"!==l,f=(0,D.U7)({shouldFocus:v});function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.preventDefault(),d({flow:"passwordless",applyNextAnimation:t})}return n.createElement(Z.ZP,null,(e=>{let{validator:l}=e;return n.createElement(i.xu,{p:5,ref:h,"data-testid":"password"},y&&n.createElement(i.xv,{color:"text.secondary"},"Step 1 of 2"),n.createElement(i.xv,{typography:"h4",bold:!0,mb:3,color:"light"},"Set A Password"),"failed"===t.status&&n.createElement(k.b0,{children:t.statusText}),n.createElement(S.Z,{label:"Username",value:r.user,onChange:()=>null,readonly:!0}),n.createElement(S.Z,{rule:A.qQ,ref:f,autoComplete:"off",label:"Password",value:c,onChange:e=>u(e.target.value),type:"password",placeholder:"Password"}),n.createElement(S.Z,{rule:(0,A.el)(c),autoComplete:"off",label:"Confirm Password",value:b,onChange:e=>g(e.target.value),type:"password",placeholder:"Confirm Password"}),n.createElement(i.DF,{width:"100%",mt:3,size:"large",onClick:e=>function(e,t){e.preventDefault(),p.y.capturePreUserEvent({event:p.z.PreUserOnboardSetCredentialSubmitEvent,username:r.user}),t.validate()&&(y?m():o(c))}(e,l),disabled:"processing"===t.status},y?"Next":"Submit"),"passwordless"!==s&&a&&n.createElement(i.xu,{mt:3,textAlign:"center"},n.createElement(i.oD,{onClick:e=>E(e),disabled:"processing"===t.status},"Go Passwordless")),"passwordless"===s&&n.createElement(i.xu,{mt:3,textAlign:"center"},n.createElement(i.oD,{onClick:e=>E(e,!0),disabled:"processing"===t.status},"Back")))}))},function(e){const{resetToken:t,submitAttempt:r,clearSubmitAttempt:a,auth2faType:o,onSubmitWithWebauthn:l,onSubmit:s,password:c,prev:u,refCallback:d,hasTransitionEnded:m}=e,[h,v]=(0,n.useState)(""),b=(0,T.Z)({auth2faType:o}),[g,y]=(0,n.useState)(b[0]),[f,E]=(0,n.useState)((()=>R(g.value))),x=(0,D.U7)({shouldFocus:m,refocusDeps:[g.value]});function w(e,t){v(""),a(),t.reset();const r=b[e];y(r),E(R(r.value))}const C="otp"===(null==g?void 0:g.value)?`data:image/png;base64,${t.qrCode}`:O;return n.createElement(Z.ZP,null,(e=>{let{validator:o}=e;return n.createElement(i.xu,{p:5,ref:d},n.createElement(i.kC,{mb:3,alignItems:"center"},n.createElement(P.xhZ,{fontSize:30,mr:3,onClick:()=>{a(),u()},style:{cursor:"pointer"}}),n.createElement(i.xu,null,n.createElement(i.xv,{color:"text.secondary"},"Step 2 of 2"),n.createElement(i.xv,{typography:"h4",color:"light",bold:!0},"Set Two-Factor Device"))),"failed"===r.status&&n.createElement(k.b0,{children:r.statusText}),n.createElement(i.xv,{typography:"subtitle1",color:"light",caps:!0,mb:1},"Two-Factor Method"),n.createElement(i.xu,{mb:1},b.map(((e,t)=>n.createElement(F,{key:t,onClick:()=>w(t,o)},n.createElement("input",{type:"radio",checked:g.value===e.value,onChange:()=>w(t,o)}),n.createElement("label",null,e.label))))),n.createElement(i.kC,{flexDirection:"column",justifyContent:"center",alignItems:"center",borderRadius:8,bg:"optional"===(null==g?void 0:g.value)?"primary.lighter":"",height:"optional"===(null==g?void 0:g.value)?"340px":"240px",px:3},"otp"===(null==g?void 0:g.value)&&n.createElement(n.Fragment,null,n.createElement(U,{src:C,width:"145px",height:"145px"}),n.createElement(i.xv,{fontSize:1,textAlign:"center",mt:2,color:"text.secondary"},"Scan the QR Code with any authenticator app and enter the generated code. We recommend"," ",n.createElement(i.rU,{href:"https://authy.com/download/",target:"_blank"},"Authy"),".")),"webauthn"===(null==g?void 0:g.value)&&n.createElement(n.Fragment,null,n.createElement(i.Ee,{src:C,width:"220px",height:"154px"}),n.createElement(i.xv,{fontSize:1,color:"text.secondary",textAlign:"center"},"We support a wide range of hardware devices including YubiKeys, Touch ID, watches, and more.")),"optional"===(null==g?void 0:g.value)&&n.createElement(i.xv,{textAlign:"center"},"We strongly recommend enrolling a two-factor device to protect both yourself and your organization.")),"optional"!==(null==g?void 0:g.value)&&n.createElement(i.kC,{alignItems:"center",height:100},n.createElement(S.Z,{rule:(0,A.lp)("Device name is required"),label:"Device name",placeholder:"Name",ref:x,width:"otp"===(null==g?void 0:g.value)?"50%":"100%",value:f,type:"text",onChange:e=>E(e.target.value),readonly:"processing"===r.status,mr:"otp"===(null==g?void 0:g.value)?3:0}),"otp"===(null==g?void 0:g.value)&&n.createElement(S.Z,{width:"50%",label:"Authenticator code",rule:A.Sb,inputMode:"numeric",autoComplete:"one-time-code",value:h,onChange:e=>v(e.target.value),placeholder:"123 456",readonly:"processing"===r.status})),n.createElement(i.DF,{width:"100%",mt:2,disabled:"processing"===r.status,size:"large",onClick:e=>function(e,r){e.preventDefault(),p.y.capturePreUserEvent({event:p.z.PreUserOnboardRegisterChallengeSubmitEvent,username:t.user}),r.validate()&&("webauthn"===(null==g?void 0:g.value)?l(c,f):s(c,h,f))}(e,o)},"Submit"))}))}],passwordless:[function(e){var t,r;const{submitAttempt:a,onSubmitWithWebauthn:o,primaryAuthType:l,isPasswordlessEnabled:s,changeFlow:c,refCallback:u,hasTransitionEnded:d,clearSubmitAttempt:m}=e,[p,h]=(0,n.useState)("passwordless-device"),v=(0,D.U7)({shouldFocus:d});function b(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.preventDefault(),m(),c({flow:"local",applyNextAnimation:t})}const g=null===(t=window.navigator)||void 0===t||null===(r=t.userAgent)||void 0===r?void 0:r.toLowerCase().includes("firefox");return n.createElement(Z.ZP,null,(e=>{let{validator:t}=e;return n.createElement(i.xu,{px:5,pb:4,pt:5,ref:u,"data-testid":"passwordless"},n.createElement(i.xv,{typography:"h4",mb:3,color:"light",bold:!0},"Set A Passwordless Device"),"failed"===a.status&&n.createElement(k.b0,{children:a.statusText}),g&&n.createElement(k.kI,{mt:3},"Firefox may not support passwordless register. Please try Chrome or Safari."),n.createElement(S.Z,{rule:(0,A.lp)("Device name is required"),label:"Device name",placeholder:"Name",width:"100%",ref:v,value:p,type:"text",onChange:e=>h(e.target.value),readonly:"processing"===a.status}),n.createElement(i.DF,{width:"100%",mt:1,size:"large",onClick:e=>function(e,t){e.preventDefault(),t.validate()&&o("",p)}(e,t),disabled:"processing"===a.status},"Submit"),"passwordless"!==l&&s&&n.createElement(i.xu,{mt:3,textAlign:"center"},n.createElement(i.oD,{onClick:e=>b(e,!0),disabled:"processing"===a.status},"Back")),"passwordless"===l&&n.createElement(i.xu,{mt:3,textAlign:"center"},n.createElement(i.oD,{onClick:e=>b(e),disabled:"processing"===a.status},"Use password")))}))}]};function I(e){let{tokenId:t="",resetMode:r=!1}=e;const a=function(e){const[t,r]=(0,n.useState)(),[a,l]=(0,n.useState)(),[i,c]=(0,n.useState)(!1),[u,d]=(0,n.useState)(!1),m=(0,y.Z)(""),p=(0,y.Z)(""),h=s.Z.getAuth2faType();function v(e){e.privateKeyPolicyEnabled&&d(!0),e.recovery.createdDate?l(e.recovery):b()}function b(){c(!0)}return(0,n.useEffect)((()=>{m.run((()=>f.ZP.fetchPasswordToken(e).then((e=>r(e)))))}),[]),{auth2faType:h,primaryAuthType:s.Z.getPrimaryAuthType(),isPasswordlessEnabled:s.Z.isPasswordlessEnabled(),fetchAttempt:m.attempt,submitAttempt:p.attempt,clearSubmitAttempt:function(){p.setAttempt({status:""})},onSubmit:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";p.setAttempt({status:"processing"}),f.ZP.resetPassword({tokenId:e,password:t,otpCode:r,deviceName:n}).then(v).catch(p.handleError)},onSubmitWithWebauthn:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";p.setAttempt({status:"processing"}),f.ZP.resetPasswordWithWebauthn({tokenId:e,password:t,deviceName:r}).then(v).catch(p.handleError)},resetToken:t,recoveryCodes:a,redirect:function(){o.Z.push(s.Z.routes.root,!0)},success:i,finishedRegister:b,privateKeyPolicyEnabled:u}}(t);return n.createElement(j,W({},a,{resetMode:r}))}function j(e){const{fetchAttempt:t,recoveryCodes:r,resetMode:a,resetToken:o,redirect:l,primaryAuthType:s,success:u,finishedRegister:d,privateKeyPolicyEnabled:m}=e;if("failed"===t.status)return n.createElement(E,{resetMode:a});if("success"!==t.status)return null;if(u&&m)return n.createElement(g.n,{title:a?"Reset Complete":"Registration Complete"});if(u)return n.createElement(C,{redirect:l,resetMode:a});if(r)return n.createElement(b,{recoveryCodes:r,onContinue:d,isNewCodes:a,username:o.user});const[p,h]=(0,n.useState)(""),[v,y]=(0,n.useState)(),[f,x]=(0,n.useState)((()=>"sso"===s||"local"===s?"local":"passwordless"));return n.createElement(i.Zb,{as:"form",bg:"primary.light",my:5,mx:"auto",width:464},n.createElement(c.z,W({flows:z,currFlow:f,onSwitchFlow:function(e){x(e)},newFlow:v,changeFlow:function(e){y(e)}},e,{password:p,updatePassword:function(e){h(e)}})))}function N(e){let{title:t,subTitle:r,btnText:a,onClick:o}=e;return n.createElement(i.Zb,{bg:"primary.light",my:6,mx:"auto",width:"464px"},n.createElement(i.xu,{p:6},n.createElement(i.xv,{typography:"h2",mb:3,textAlign:"center",color:"light"},t),n.createElement(i.xv,{typography:"h5",mb:3,textAlign:"center"},r),n.createElement(i.DF,{width:"100%",mt:3,size:"large",onClick:o},a)))}const M=function(){const{tokenId:e}=(0,a.UO)();return n.createElement(n.Fragment,null,n.createElement(l.Z,null),n.createElement(a.rs,null,n.createElement(a.AW,{exact:!0,path:s.Z.routes.userInvite},n.createElement(N,{title:"Welcome to Teleport",subTitle:"Please click the button below to create an account",btnText:"Get started",onClick:()=>{o.Z.push(s.Z.getUserInviteTokenContinueRoute(e))}})),n.createElement(a.AW,{exact:!0,path:s.Z.routes.userReset},n.createElement(N,{title:"Reset Authentication",subTitle:"Please click the button below to begin recovery of your account",btnText:"Continue",onClick:()=>{o.Z.push(s.Z.getUserResetTokenContinueRoute(e))}})),n.createElement(a.AW,{path:s.Z.routes.userInviteContinue},n.createElement(I,{tokenId:e})),n.createElement(a.AW,{path:s.Z.routes.userResetContinue},n.createElement(I,{resetMode:!0,tokenId:e}))))}},2376:(e,t,r)=>{r.d(t,{z:()=>c.z,y:()=>i});var n=r(1452),a=r(7278);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const i={captureUserEvent(e){n.ZP.fetch(a.Z.api.captureUserEventPath,{method:"POST",body:JSON.stringify(e)})},capturePreUserEvent(e){n.ZP.fetch(a.Z.api.capturePreUserEventPath,{method:"POST",body:JSON.stringify(l({},e))})}};var c=r(2412)},2412:(e,t,r)=>{var n;r.d(t,{z:()=>n}),function(e){e.BannerClickEvent="tp.ui.banner.click",e.OnboardAddFirstResourceClickEvent="tp.ui.onboard.addFirstResource.click",e.OnboardAddFirstResourceLaterClickEvent="tp.ui.onboard.addFirstResourceLater.click",e.PreUserOnboardGetStartedClickEvent="tp.ui.onboard.getStarted.click",e.PreUserOnboardSetCredentialSubmitEvent="tp.ui.onboard.setCredential.submit",e.PreUserOnboardRegisterChallengeSubmitEvent="tp.ui.onboard.registerChallenge.submit",e.PreUserRecoveryCodesContinueClickEvent="tp.ui.recoveryCodesContinue.click"}(n||(n={}))}}]);