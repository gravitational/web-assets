"use strict";(self.webpackChunk_gravitational_teleport=self.webpackChunk_gravitational_teleport||[]).push([[550],{4207:(e,t,r)=>{r.d(t,{x:()=>g});var n=r(2784),o=r(917),s=r(7933),a=r(2760),l=r(2865),c=r(7849),i=r(3757);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class h extends Error{constructor(){super("Ignored response from stale useAsync request"),this.name="CanceledError"}}function f(){return{data:null,status:"",statusText:""}}const g=n.forwardRef(((e,t)=>{const{onSelect:r,anchorOrigin:o,transformOrigin:s,required:l=!0,width:u}=e,p=(0,n.useRef)(),[g,b]=(0,n.useState)(!1),[y,x]=function(e){const[t,r]=(0,n.useState)(f),o=function(){const e=(0,n.useRef)(!1);return(0,n.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),(0,n.useCallback)((()=>e.current),[])}(),s=(0,n.useRef)(),a=(0,n.useCallback)((function(){r((e=>d(d({},e),{},{status:"processing"})));const t=e(...arguments);return s.current=t,t.then((e=>o()?s.current!==t?[null,new h]:(r((t=>d(d({},t),{},{status:"success",data:e}))),[e,null]):[null,new h]),(e=>o()?s.current!==t?[null,new h]:(r((t=>d(d({},t),{},{status:"error",statusText:null==e?void 0:e.message,data:null}))),[null,e]):[null,new h]))}),[r,e,o]);return[t,a,(0,n.useCallback)((e=>{r(e)}),[r])]}((()=>Promise.resolve().then((()=>e.getLoginItems())))),O=e.placeholder||"Enter login name…",v=()=>{y.status||x(),b(!0)},P=()=>{b(!1)};return(0,n.useImperativeHandle)(t,(()=>({open:()=>{v()}}))),n.createElement(n.Fragment,null,n.createElement(c.ku,{height:"24px",size:"small",setRef:p,onClick:v},"CONNECT",n.createElement(i.E_,{ml:2,mr:-2,fontSize:"2",color:"text.secondary"})),n.createElement(a.ZP,{anchorOrigin:o,transformOrigin:s,anchorEl:p.current,open:g,onClose:P,getContentAnchorEl:null},n.createElement(m,{getLoginItemsAttempt:y,onKeyPress:e=>{"Enter"!==e.key||l&&!e.currentTarget.value||(P(),r(e,e.currentTarget.value))},onClick:(e,t)=>{P(),r(e,t)},placeholder:O,width:u})))})),m=e=>{let{getLoginItemsAttempt:t,onClick:r,onKeyPress:o,placeholder:a,width:l}=e;const i=function(e,t){switch(e.status){case"":case"processing":return n.createElement(O,null);case"error":return null;case"success":return e.data.map(((e,r)=>{const{login:o,url:a}=e;return n.createElement(y,{key:r,px:"2",mx:"2",as:a?s.OL:b,to:a,onClick:e=>{t(e,o)}},o)}))}}(t,r);return n.createElement(c.kC,{flexDirection:"column",width:l},n.createElement(x,{p:"2",m:"2",onKeyPress:o,type:"text",autoFocus:!0,placeholder:a,autoComplete:"off"}),i)},b=o.ZP.button(["color:inherit;border:none;flex:1;"]),y=(0,o.ZP)(a.sN)((e=>{let{theme:t}=e;return`\n  color: ${t.colors.grey[400]};\n  font-size: 12px;\n  border-bottom: 1px solid ${t.colors.subtle};\n  min-height: 32px;\n  &:hover {\n    color: ${t.colors.link};\n  }\n\n  :last-child {\n    border-bottom: none;\n    margin-bottom: 8px;\n  }\n`})),x=o.ZP.input((e=>{let{theme:t}=e;return`\n  background: ${t.colors.subtle};\n  border: 1px solid ${t.colors.subtle};\n  border-radius: 4px;\n  box-sizing: border-box;\n  color: ${t.colors.grey[900]};\n  height: 32px;\n  outline: none;\n\n  &:focus {\n    background: ${t.colors.light};\n    border 1px solid ${t.colors.link};\n    box-shadow: inset 0 1px 3px rgba(0, 0, 0, .24);\n  }\n\n  ::placeholder {\n    color: ${t.colors.grey[100]};\n  }\n`}),l.Dh);var O=(0,o.ZP)(c.z$)(["",""],(e=>{let{theme:t}=e;return`\n            align-self: center;\n            color: ${t.colors.secondary.dark}\n          `}))},8604:(e,t,r)=>{r.d(t,{X:()=>g,Z:()=>f});var n=r(2784),o=r(4517),s=r(4696),a=r(1392),l=r(7278),c=r(3228),i=r(321),u=r(9068);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){const{isLeafCluster:r,clusterId:d}=t,{search:h,pathname:f}=(0,o.TH)(),[m,b]=(0,n.useState)([]),{attempt:y,setAttempt:x}=(0,s.Z)("processing"),O=e.storeUser.getTokenAccess().create,[v,P]=(0,n.useState)(""),[S,w]=(0,n.useState)(p({sort:{fieldName:"hostname",dir:"ASC"}},(0,i.Z)(h))),E=!(null!=S&&S.query||null!=S&&S.search),[k,C]=(0,n.useState)({nodes:[],startKey:"",totalCount:0}),j=k.totalCount>0?15*(m.length-2)+1:0,$=k.totalCount>0?j+k.nodes.length-1:0;function K(e){a.Z.replace(e)}return(0,n.useEffect)((()=>{x({status:"processing"}),e.nodeService.fetchNodes(d,p(p({},S),{},{limit:15})).then((e=>{C({nodes:e.agents,startKey:e.startKey,totalCount:e.totalCount}),P(e.startKey?"":"disabled"),b(["",e.startKey]),x({status:"success"})})).catch((e=>{x({status:"failed",statusText:e.message}),C(p(p({},k),{},{nodes:[],totalCount:0})),b([""])}))}),[d,h]),{canCreate:O,attempt:y,getNodeLoginOptions:function(e){const t=k.nodes.find((t=>t.id==e));return function(e,t){const r=(null==t?void 0:t.sshLogins)||[];return g(r).map((r=>({login:r,url:l.Z.getSshConnectRoute({clusterId:e,serverId:(null==t?void 0:t.id)||"",login:r})})))}(d,t)},startSshSession:(e,t)=>{const r=l.Z.getSshConnectRoute({clusterId:d,serverId:t,login:e});(0,c.RB)(r)},isLeafCluster:r,clusterId:d,results:k,fetchNext:()=>{P("loading"),e.nodeService.fetchNodes(d,p(p({},S),{},{limit:15,startKey:k.startKey})).then((e=>{C(p(p({},k),{},{nodes:e.agents,startKey:e.startKey})),P(e.startKey?"":"disabled"),b([...m,e.startKey])})).catch((e=>{x({status:"failed",statusText:e.message})}))},fetchPrev:()=>{P("loading"),e.nodeService.fetchNodes(d,p(p({},S),{},{limit:15,startKey:m[m.length-3]})).then((e=>{const t=m;t.pop(),b(t),C(p(p({},k),{},{nodes:e.agents,startKey:e.startKey})),P("")})).catch((e=>{x({status:"failed",statusText:e.message})}))},pageSize:15,from:j,to:$,params:S,setParams:w,startKeys:m,setSort:function(e){w(p(p({},S),{},{sort:e}))},pathname:f,replaceHistory:K,fetchStatus:v,isSearchEmpty:E,onLabelClick:e=>(0,u.Z)(e,S,w,f,K)}}const g=e=>{const t=e.filter((e=>"root"!==e)).sort();return t.length===e.length?e:["root",...t]}},6189:(e,t,r)=>{r.d(t,{Z:()=>c});var n=r(2784),o=r(3652),s=r(4207),a=r(6071);const l=e=>{let{addr:t,tunnel:r}=e;return n.createElement(o.bL,null,r?n.createElement("span",{style:{cursor:"default"},title:"This node is connected to cluster through reverse tunnel"},"⟵ tunnel"):t)},c=function(e){const{nodes:t=[],onLoginMenuOpen:r,onLoginSelect:c,pageSize:i,totalCount:u,fetchNext:d,fetchPrev:p,fetchStatus:h,from:f,to:g,params:m,setParams:b,startKeys:y,setSort:x,pathname:O,replaceHistory:v,onLabelClick:P}=e;return n.createElement(o.ZP,{columns:[{key:"hostname",headerText:"Hostname",isSortable:!0},{key:"addr",headerText:"Address",render:l},{key:"labels",headerText:"Labels",render:e=>{let{labels:t}=e;return n.createElement(o.aW,{labels:t,onClick:P})}},{altKey:"connect-btn",render:e=>{let{id:t}=e;return((e,t,r)=>n.createElement(o.bL,{align:"right"},n.createElement(s.x,{getLoginItems:function(){return r(e)},onSelect:function(r,n){return t?t(r,n,e):[]},transformOrigin:{vertical:"top",horizontal:"right"},anchorOrigin:{vertical:"center",horizontal:"right"}})))(t,c,r)}}],emptyText:"No Nodes Found",data:t,pagination:{pageSize:i},fetching:{onFetchNext:d,onFetchPrev:p,fetchStatus:h},serversideProps:{sort:m.sort,setSort:x,startKeys:y,serversideSearchPanel:n.createElement(a.Z,{from:f,to:g,count:u,params:m,setParams:b,pathname:O,replaceHistory:v})}})}},6900:(e,t,r)=>{r.d(t,{Z:()=>h});var n=r(2784),o=r(917),s=r(7849),a=r(3815);const l=["onPress","autoFocus","inputProps"];function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c.apply(this,arguments)}const i=/^(?:(?<username>[^\s]+)@)(?<host>[^\s]+)$/,u=(0,o.ZP)(s.kC)(["align-items:center;height:32px;border:1px solid;border-radius:4px;border-color:rgba(255,255,255,0.24);",""],(function(e){let{hasError:t,theme:r}=e;if(t)return{border:`1px solid ${r.colors.error.main}`,paddifngLeft:"7px",paddifngRight:"1px"}})),d=o.ZP.div(["opacity:0.75;font-size:11px;font-weight:500;padding:0 8px;border-bottom-left-radius:4px;border-top-left-radius:4px;"]),p=o.ZP.input(["appearance:none;border:none;border-radius:4px;box-sizing:border-box;border-bottom-left-radius:unset;border-top-left-radius:unset;display:block;outline:none;width:100%;height:100%;box-shadow:none;padding-left:8px;font-size:12px;::-ms-clear{display:none;}:read-only{cursor:not-allowed;}::placeholder{opacity:1;color:",";font-size:","px;}&:hover,&:focus{background:",";}"," "," "," ",";"],(e=>e.theme.colors.text.placeholder),(e=>e.theme.fontSizes[1]),(e=>e.theme.colors.primary.lighter),a.$_,a.Dh,a.bf,a.Cb),h=function(e){let{onPress:t,autoFocus:r=!1,inputProps:o={}}=e,s=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,l);const[a,h]=n.useState(!1);return n.createElement(u,c({},s,{hasError:a}),n.createElement(d,null,"SSH:"),n.createElement(p,c({bg:"primary.light",color:"text.primary",placeholder:"login@host:port",autoFocus:r,onKeyPress:function(e){const r=e.target.value;if("Enter"!==e.key&&"click"!==e.type||!r)h(!1);else{const e=(e=>i.exec(e.trim()))(r);if(h(!e),e){const{username:r,host:n}=e.groups;t(r,n)}}}},o)))}},3228:(e,t,r)=>{r.d(t,{ES:()=>a,Kp:()=>o,RB:()=>n,Sl:()=>s});const n=e=>{const t=document.createElement("a");t.setAttribute("href",`${e}`),t.setAttribute("target","_blank"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)};async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new TextEncoder;const r=t.encode(e),n=await crypto.subtle.digest("SHA-256",r),o=Array.from(new Uint8Array(n)),s=o.map((e=>e.toString(16).padStart(2,"0"))).join("");return s}function s(e){let{authType:t,clusterId:r="",username:n,accessRequestId:o=""}=e;const{hostname:s,port:a}=window.location,l=`${s}:${a||"443"}`,c=o?` --request-id=${o}`:"";switch(t){case"sso":return`tsh login --proxy=${l} ${r}${c}`.trim();case"local":case"passwordless":return`tsh login --proxy=${l} --auth=${t} --user=${n} ${r}${c}`.trim();default:throw new Error(`auth type ${t} is not supported`)}}function a(e,t){return e&&t?e.filter((e=>!t.includes(e))):[]}}}]);