"use strict";(self.webpackChunk_gravitational_teleport=self.webpackChunk_gravitational_teleport||[]).push([[773],{2674:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var r=n(2784),a=n(7885),o=n(1392),l=n(4116),s=n(7278),i=n(7849),c=n(5081),u=n(917),d=n(5070),m=n(3388);const p=(0,u.ZP)(i.xu)([".print-only{visibility:hidden;}@media print{overflow:hidden;.print,.print-only{visibility:visible;}.no-print{visibility:hidden;}.codes{font-size:16px;}}"]),h=(0,u.ZP)(i.DF)(["max-width:48px;width:100%;padding:4px 8px;min-height:10px;font-size:10px;"]),v=function(e){let{recoveryCodes:t,onContinue:n,isNewCodes:a,continueText:o="Continue"}=e;const l=(0,r.useRef)();let s="Backup & Recovery Codes",c=`I have saved my Recovery Codes - ${o}`;return a&&(s="New Backup & Recovery Codes",c=`I have saved my new Recovery Codes - ${o}`),r.createElement(p,null,r.createElement(i.Zb,{as:i.kC,flexWrap:"wrap",mx:"auto",minWidth:"584px",maxWidth:"1024px",borderRadius:8,overflow:"hidden",className:"no-print"},r.createElement(i.kC,{flex:4,bg:"primary.light",minWidth:"584px",flexDirection:"column",p:5,className:"print"},r.createElement(i.xu,{mb:5},r.createElement(i.xv,{typography:"h2",mb:3,color:"light"},s),r.createElement(i.xv,{mb:1},"Please save these account recovery codes in a safe offline place."),r.createElement(i.xv,null,"You can use each code once if you lose your second factor authenticator or password.")),r.createElement(i.xu,null,r.createElement(i.xv,{bold:!0,mb:2,caps:!0},"Recovery Codes (",null==t?void 0:t.codes.length," Total)"),r.createElement(i.kC,{bg:"primary.dark",p:2,pb:4,pl:3,borderRadius:8,justifyContent:"space-between"},r.createElement(i.xv,{style:{whiteSpace:"pre-wrap"},mt:2,ref:l,className:"codes"},null==t?void 0:t.codes.join("\n\n")),r.createElement(i.kC,{flexDirection:"column",className:"no-print",ml:2},r.createElement(h,{onClick:()=>{(0,d.Z)(`${null==t?void 0:t.codes.join("\n")} \n\nCreated: ${null==t?void 0:t.createdDate}`).then((()=>{(0,m.Z)(l.current)}))}},"COPY"),r.createElement(h,{onClick:window.print,mt:2},"PRINT"))),r.createElement(i.xv,{className:"print-only"},`Created: ${null==t?void 0:t.createdDate.toString()}`),r.createElement(i.DF,{mt:6,size:"large",width:"100%",className:"no-print",onClick:n},c))),r.createElement(i.kC,{flex:2,bg:"primary.main",minWidth:"384px",flexDirection:"column",p:5},r.createElement(i.xu,{mb:4},r.createElement(i.xv,{typography:"h4",mb:2},"Why do I need these codes?"),r.createElement(i.xv,{color:"text.secondary"},"Use them in the event of losing your password or two-factor device.")),r.createElement(i.xu,{mb:4},r.createElement(i.xv,{typography:"h4",mb:2},"How long do the codes last for?"),r.createElement(i.xv,{color:"text.secondary"},"Recovery codes can only be used once. After recovering your account, we will generate a new set of codes for you.")),a&&r.createElement(i.xu,null,r.createElement(i.xv,{typography:"h4",mb:2},"What about my old codes?"),r.createElement(i.xv,{color:"text.secondary"},"Your old recovery codes are no longer valid, please replace them with these new ones.")))))};var g=n(2966),y=n(4696),b=n(9376);function f(e){let{resetMode:t=!1}=e;const n=t?"Reset":"Invitation",a=t?"reset":"invite";return r.createElement(i.Zb,{width:"540px",color:"text.onLight",p:6,bg:"light",mt:6,mx:"auto"},r.createElement(i.xv,{typography:"h1",textAlign:"center",fontSize:8,color:"text",mb:3},n," Code Expired"),r.createElement(i.xv,{typography:"paragraph",mb:"2"},"It appears that your ",a," code isn't valid any more. Please contact your account administrator and request another ",a," ","link."),r.createElement(i.xv,{typography:"paragraph"},"If you believe this is an issue with the product, please create a",r.createElement(E,null," GitHub issue"),"."))}const E=u.ZP.a.attrs({href:"https://github.com/gravitational/teleport/issues/new"})(["color:",";&:visted{color:",";}"],(e=>e.theme.colors.link),(e=>e.theme.colors.link)),x=n.p+"assets/img/img-3fc1dd.png";function w(e){let{redirect:t,resetMode:n=!1}=e;const a=n?"reset":"registration";return r.createElement(i.Zb,{width:"540px",p:6,bg:"primary.light",mt:6,mx:"auto",textAlign:"center"},r.createElement(i.xv,{typography:"h3",color:"text",mb:3,style:{textTransform:"capitalize"}},a," successful"),r.createElement(i.kC,{justifyContent:"center",mb:3},r.createElement(i.Ee,{src:x,width:"200px",height:"143px"})),r.createElement(i.xv,{fontSize:2,color:"text.secondary",mb:4},"Congratulations your ",a," is completed.",r.createElement("br",null),"Proceed to access your account."),r.createElement(i.DF,{width:"100%",size:"large",onClick:t},"Go to Dashboard"))}var C=n(9124),k=n(3757),A=n(2030),Z=n(8197),P=n(7097),S=n(9750),T=n(9127);const D=n.p+"assets/img/img-aae28f.png";function R(e){return"webauthn"===e?"webauthn-device":"otp"===e?"otp-device":""}const W=u.ZP.div(["display:inline-block;margin-right:16px;cursor:pointer;input{cursor:pointer;vertical-align:middle;margin:0 8px 0px 0;}label{cursor:pointer;vertical-align:middle;}"]);var F=(0,u.ZP)(i.Ee)(["border:4px solid white;"]);function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},I.apply(this,arguments)}const N={local:[function(e){const{submitAttempt:t,resetToken:n,isPasswordlessEnabled:a,onSubmit:o,auth2faType:l,primaryAuthType:s,password:c,updatePassword:u,changeFlow:d,next:m,refCallback:p,hasTransitionEnded:h}=e,[v,g]=(0,r.useState)(""),y="off"!==l,b=(0,T.U7)({shouldFocus:h});function f(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.preventDefault(),d({flow:"passwordless",applyNextAnimation:t})}return r.createElement(Z.ZP,null,(e=>{let{validator:l}=e;return r.createElement(i.xu,{p:5,ref:p,"data-testid":"password"},y&&r.createElement(i.xv,{color:"text.secondary"},"Step 1 of 2"),r.createElement(i.xv,{typography:"h4",bold:!0,mb:3,color:"light"},"Set A Password"),"failed"===t.status&&r.createElement(C.b0,{children:t.statusText}),r.createElement(A.Z,{label:"Username",value:n.user,onChange:()=>null,readonly:!0}),r.createElement(A.Z,{rule:P.qQ,ref:b,autoComplete:"off",label:"Password",value:c,onChange:e=>u(e.target.value),type:"password",placeholder:"Password"}),r.createElement(A.Z,{rule:(0,P.el)(c),autoComplete:"off",label:"Confirm Password",value:v,onChange:e=>g(e.target.value),type:"password",placeholder:"Confirm Password"}),r.createElement(i.DF,{width:"100%",mt:3,size:"large",onClick:e=>function(e,t){e.preventDefault(),t.validate()&&(y?m():o(c))}(e,l),disabled:"processing"===t.status},y?"Next":"Submit"),"passwordless"!==s&&a&&r.createElement(i.xu,{mt:3,textAlign:"center"},r.createElement(i.oD,{onClick:e=>f(e),disabled:"processing"===t.status},"Go Passwordless")),"passwordless"===s&&r.createElement(i.xu,{mt:3,textAlign:"center"},r.createElement(i.oD,{onClick:e=>f(e,!0),disabled:"processing"===t.status},"Back")))}))},function(e){const{resetToken:t,submitAttempt:n,clearSubmitAttempt:a,auth2faType:o,onSubmitWithWebauthn:l,onSubmit:s,password:c,prev:u,refCallback:d,hasTransitionEnded:m}=e,[p,h]=(0,r.useState)(""),v=(0,S.Z)({auth2faType:o}),[g,y]=(0,r.useState)(v[0]),[b,f]=(0,r.useState)((()=>R(g.value))),E=(0,T.U7)({shouldFocus:m,refocusDeps:[g.value]});function x(e,t){h(""),a(),t.reset();const n=v[e];y(n),f(R(n.value))}const w="otp"===(null==g?void 0:g.value)?`data:image/png;base64,${t.qrCode}`:D;return r.createElement(Z.ZP,null,(e=>{let{validator:t}=e;return r.createElement(i.xu,{p:5,ref:d},r.createElement(i.kC,{mb:3,alignItems:"center"},r.createElement(k.xhZ,{fontSize:30,mr:3,onClick:()=>{a(),u()},style:{cursor:"pointer"}}),r.createElement(i.xu,null,r.createElement(i.xv,{color:"text.secondary"},"Step 2 of 2"),r.createElement(i.xv,{typography:"h4",color:"light",bold:!0},"Set Two-Factor Device"))),"failed"===n.status&&r.createElement(C.b0,{children:n.statusText}),r.createElement(i.xv,{typography:"subtitle1",color:"light",caps:!0,mb:1},"Two-Factor Method"),r.createElement(i.xu,{mb:1},v.map(((e,n)=>r.createElement(W,{key:n,onClick:()=>x(n,t)},r.createElement("input",{type:"radio",checked:g.value===e.value,onChange:()=>x(n,t)}),r.createElement("label",null,e.label))))),r.createElement(i.kC,{flexDirection:"column",justifyContent:"center",alignItems:"center",borderRadius:8,bg:"optional"===(null==g?void 0:g.value)?"primary.lighter":"",height:"optional"===(null==g?void 0:g.value)?"340px":"240px",px:3},"otp"===(null==g?void 0:g.value)&&r.createElement(r.Fragment,null,r.createElement(F,{src:w,width:"145px",height:"145px"}),r.createElement(i.xv,{fontSize:1,textAlign:"center",mt:2,color:"text.secondary"},"Scan the QR Code with any authenticator app and enter the generated code. We recommend"," ",r.createElement(i.rU,{href:"https://authy.com/download/",target:"_blank"},"Authy"),".")),"webauthn"===(null==g?void 0:g.value)&&r.createElement(r.Fragment,null,r.createElement(i.Ee,{src:w,width:"220px",height:"154px"}),r.createElement(i.xv,{fontSize:1,color:"text.secondary",textAlign:"center"},"We support a wide range of hardware devices including YubiKeys, Touch ID, watches, and more.")),"optional"===(null==g?void 0:g.value)&&r.createElement(i.xv,{textAlign:"center"},"We strongly recommend enrolling a two-factor device to protect both yourself and your organization.")),"optional"!==(null==g?void 0:g.value)&&r.createElement(i.kC,{alignItems:"center",height:100},r.createElement(A.Z,{rule:(0,P.lp)("Device name is required"),label:"Device name",placeholder:"Name",ref:E,width:"otp"===(null==g?void 0:g.value)?"50%":"100%",value:b,type:"text",onChange:e=>f(e.target.value),readonly:"processing"===n.status,mr:"otp"===(null==g?void 0:g.value)?3:0}),"otp"===(null==g?void 0:g.value)&&r.createElement(A.Z,{width:"50%",label:"Authenticator code",rule:P.Sb,inputMode:"numeric",autoComplete:"one-time-code",value:p,onChange:e=>h(e.target.value),placeholder:"123 456",readonly:"processing"===n.status})),r.createElement(i.DF,{width:"100%",mt:2,disabled:"processing"===n.status,size:"large",onClick:e=>function(e,t){e.preventDefault(),t.validate()&&("webauthn"===(null==g?void 0:g.value)?l(c,b):s(c,p,b))}(e,t)},"Submit"))}))}],passwordless:[function(e){var t,n;const{submitAttempt:a,onSubmitWithWebauthn:o,primaryAuthType:l,isPasswordlessEnabled:s,changeFlow:c,refCallback:u,hasTransitionEnded:d,clearSubmitAttempt:m}=e,[p,h]=(0,r.useState)("passwordless-device"),v=(0,T.U7)({shouldFocus:d});function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.preventDefault(),m(),c({flow:"local",applyNextAnimation:t})}const y=null===(t=window.navigator)||void 0===t||null===(n=t.userAgent)||void 0===n?void 0:n.toLowerCase().includes("firefox");return r.createElement(Z.ZP,null,(e=>{let{validator:t}=e;return r.createElement(i.xu,{px:5,pb:4,pt:5,ref:u,"data-testid":"passwordless"},r.createElement(i.xv,{typography:"h4",mb:3,color:"light",bold:!0},"Set A Passwordless Device"),"failed"===a.status&&r.createElement(C.b0,{children:a.statusText}),y&&r.createElement(C.kI,{mt:3},"Firefox may not support passwordless register. Please try Chrome or Safari."),r.createElement(A.Z,{rule:(0,P.lp)("Device name is required"),label:"Device name",placeholder:"Name",width:"100%",ref:v,value:p,type:"text",onChange:e=>h(e.target.value),readonly:"processing"===a.status}),r.createElement(i.DF,{width:"100%",mt:1,size:"large",onClick:e=>function(e,t){e.preventDefault(),t.validate()&&o("",p)}(e,t),disabled:"processing"===a.status},"Submit"),"passwordless"!==l&&s&&r.createElement(i.xu,{mt:3,textAlign:"center"},r.createElement(i.oD,{onClick:e=>g(e,!0),disabled:"processing"===a.status},"Back")),"passwordless"===l&&r.createElement(i.xu,{mt:3,textAlign:"center"},r.createElement(i.oD,{onClick:e=>g(e),disabled:"processing"===a.status},"Use password")))}))}]};function z(e){let{tokenId:t="",resetMode:n=!1}=e;const a=function(e){const[t,n]=(0,r.useState)(),[a,l]=(0,r.useState)(),[i,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(!1),m=(0,y.Z)(""),p=(0,y.Z)(""),h=s.Z.getAuth2faType();function v(e){e.privateKeyPolicyEnabled&&d(!0),e.recovery.createdDate?l(e.recovery):g()}function g(){c(!0)}return(0,r.useEffect)((()=>{m.run((()=>b.ZP.fetchPasswordToken(e).then((e=>n(e)))))}),[]),{auth2faType:h,primaryAuthType:s.Z.getPrimaryAuthType(),isPasswordlessEnabled:s.Z.isPasswordlessEnabled(),fetchAttempt:m.attempt,submitAttempt:p.attempt,clearSubmitAttempt:function(){p.setAttempt({status:""})},onSubmit:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";p.setAttempt({status:"processing"}),b.ZP.resetPassword({tokenId:e,password:t,otpCode:n,deviceName:r}).then(v).catch(p.handleError)},onSubmitWithWebauthn:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";p.setAttempt({status:"processing"}),b.ZP.resetPasswordWithWebauthn({tokenId:e,password:t,deviceName:n}).then(v).catch(p.handleError)},resetToken:t,recoveryCodes:a,redirect:function(){o.Z.push(s.Z.routes.root,!0)},success:i,finishedRegister:g,privateKeyPolicyEnabled:u}}(t);return r.createElement(M,I({},a,{resetMode:n}))}function M(e){const{fetchAttempt:t,recoveryCodes:n,resetMode:a,redirect:o,primaryAuthType:l,success:s,finishedRegister:u,privateKeyPolicyEnabled:d}=e;if("failed"===t.status)return r.createElement(f,{resetMode:a});if("success"!==t.status)return null;if(s&&d)return r.createElement(g.n,{title:a?"Reset Complete":"Registration Complete"});if(s)return r.createElement(w,{redirect:o,resetMode:a});if(n)return r.createElement(v,{recoveryCodes:n,onContinue:u,isNewCodes:a});const[m,p]=(0,r.useState)(""),[h,y]=(0,r.useState)(),[b,E]=(0,r.useState)((()=>"sso"===l||"local"===l?"local":"passwordless"));return r.createElement(i.Zb,{as:"form",bg:"primary.light",my:5,mx:"auto",width:464},r.createElement(c.z,I({flows:N,currFlow:b,onSwitchFlow:function(e){E(e)},newFlow:h,changeFlow:function(e){y(e)}},e,{password:m,updatePassword:function(e){p(e)}})))}function U(e){let{title:t,subTitle:n,btnText:a,onClick:o}=e;return r.createElement(i.Zb,{bg:"primary.light",my:6,mx:"auto",width:"464px"},r.createElement(i.xu,{p:6},r.createElement(i.xv,{typography:"h2",mb:3,textAlign:"center",color:"light"},t),r.createElement(i.xv,{typography:"h5",mb:3,textAlign:"center"},n),r.createElement(i.DF,{width:"100%",mt:3,size:"large",onClick:o},a)))}const j=function(){const{tokenId:e}=(0,a.UO)();return r.createElement(r.Fragment,null,r.createElement(l.Z,null),r.createElement(a.rs,null,r.createElement(a.AW,{exact:!0,path:s.Z.routes.userInvite},r.createElement(U,{title:"Welcome to Teleport",subTitle:"Please click the button below to create an account",btnText:"Get started",onClick:()=>{o.Z.push(s.Z.getUserInviteTokenContinueRoute(e))}})),r.createElement(a.AW,{exact:!0,path:s.Z.routes.userReset},r.createElement(U,{title:"Reset Authentication",subTitle:"Please click the button below to begin recovery of your account",btnText:"Continue",onClick:()=>{o.Z.push(s.Z.getUserResetTokenContinueRoute(e))}})),r.createElement(a.AW,{path:s.Z.routes.userInviteContinue},r.createElement(z,{tokenId:e})),r.createElement(a.AW,{path:s.Z.routes.userResetContinue},r.createElement(z,{resetMode:!0,tokenId:e}))))}}}]);